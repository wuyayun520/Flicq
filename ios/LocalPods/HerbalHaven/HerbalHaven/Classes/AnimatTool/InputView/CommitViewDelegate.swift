
//: Declare String Begin

/*: "btn_talk_voice_nor" :*/
fileprivate let str_dropShootName:[Character] = ["b","t","n","_","t","a","l"]
fileprivate let str_dismissName:String = "top bubble icon itemk_vo"

/*: "btn_talk_voice_pre" :*/
fileprivate let str_editData:String = "btn_attention style cover self self"
fileprivate let str_reData:String = "to return imageoice_p"
fileprivate let str_intimateData:[Character] = ["r","e"]

/*: "contentSize" :*/
fileprivate let str_eventTableUpValue:String = "C"
fileprivate let str_fatalData:String = "onttot"

/*: "init(coder:) has not been implemented" :*/
fileprivate let str_backgroundResultValue:[UInt8] = [0x21,0x26,0x21,0x3c,0x60,0x2b,0x27,0x2c,0x2d,0x3a,0x72,0x61,0x68,0x20,0x29,0x3b,0x68,0x26,0x27,0x3c,0x68,0x2a,0x2d,0x2d,0x26,0x68,0x21,0x25,0x38,0x24,0x2d,0x25,0x2d,0x26,0x3c,0x2d,0x2c]

private func primrosePath(frame num: UInt8) -> UInt8 {
    return num ^ 72
}

/*: "btn_talk_more_photo_nor" :*/
fileprivate let str_makeTextName:String = "make am allow anybtn_ta"
fileprivate let str_actualValue:String = "loop normalore_p"
fileprivate let str_remainingData:String = "HOTO"

/*: "btn_news_shotVideo_nor" :*/
fileprivate let str_whiteText:String = "btn_nstatus make index"
fileprivate let str_componentTitle:String = "hotVitransform stream block"
fileprivate let str_dayValue:String = "action"

/*: "btn_news_video_nor" :*/
fileprivate let str_makeData:[Character] = ["b","t","n","_","n","e","w","s","_","v","i","d","e","o","_","n"]
fileprivate let str_toLengthData:[Character] = ["o","r"]

/*: "btn_talk_map_nor" :*/
fileprivate let str_pushContent:[Character] = ["b","t"]
fileprivate let str_tapLabData:[Character] = ["n","_","t","a","l","k","_","m","a","p","_","n","o","r"]

/*: "btn_talk_gift_nor" :*/
fileprivate let str_appearManagerData:String = "background elsebtn_"
fileprivate let str_imageModelValue:String = "pick make level var_gi"
fileprivate let str_infoVoiceTitle:[Character] = ["f","t","_","n","o","r"]

/*: "btn_more_game_nor" :*/
fileprivate let str_markData:[Character] = ["b","t","n","_","m","o","r"]
fileprivate let str_physicalText:[Character] = ["e","_","g","a","m","e","_","n","o","r"]

/*: "F5F5F5" :*/
fileprivate let str_selectedActualData:String = "warnwarnwarn"

/*: "btn_talk_send_pre" :*/
fileprivate let str_sexData:[Character] = ["b","t","n","_","t","a","l","k","_","s"]
fileprivate let str_bindName:[Character] = ["e","n","d","_","p","r","e"]

/*: "btn_talk_send_nor" :*/
fileprivate let str_acrossName:[Character] = ["b","t","n","_","t","a","l"]
fileprivate let str_fieldSexData:String = "k_senrow equal top"

/*: "#EBEBEB" :*/
fileprivate let str_weName:String = "color space#EBEBEB"

/*: "#999999" :*/
fileprivate let str_actionName:[Character] = ["#"]
fileprivate let str_userPathData:String = "999999"

/*: "Type a message…" :*/
fileprivate let str_nativeData:String = "add add if self letType a "
fileprivate let str_normalTitle:[Character] = ["m","e","s","s","a","g","e","…"]

/*: "Hold to talk" :*/
fileprivate let str_labelData:String = "frame view as guard pathHold t"
fileprivate let str_recordingValue:String = "cell"
fileprivate let str_timeResultData:String = "let view hidden talk"

/*: "#DDDDDD" :*/
fileprivate let str_exampleName:[Character] = ["#","D","D","D","D","D","D"]

/*: "A maximum of 10 people can be @ one message" :*/
fileprivate let str_biologyTitle:[UInt8] = [0x33,0x52,0x1f,0x13,0xa,0x1b,0x1f,0x7,0x1f,0x52,0x1d,0x14,0x52,0x43,0x42,0x52,0x2,0x17,0x1d,0x2,0x1e,0x17,0x52,0x11,0x13,0x1c,0x52,0x10,0x17,0x52,0x32,0x52,0x1d,0x1c,0x17,0x52,0x1f,0x17,0x1,0x1,0x13,0x15,0x17]

private func commonFraction(tip num: UInt8) -> UInt8 {
    return num ^ 114
}

/*: "@ :*/
fileprivate let str_makeText:String = "vertical"

/*: "name" :*/
fileprivate let str_frontValue:[Character] = ["n","a","m","e"]

/*: "length" :*/
fileprivate let str_whoColorValue:[Character] = ["l","e","n","g","t","h"]

/*: "<at>@ :*/
fileprivate let str_photoLaboratoryData:[Character] = ["<","a","t",">","@"]

/*: </at> " :*/
fileprivate let str_textToData:[Character] = ["<"]
fileprivate let str_moreTitle:String = "/at> self color custom top"

/*: "uid" :*/
fileprivate let str_kitName:String = "iconid"

/*: "btn_talk_keyboard_nor" :*/
fileprivate let str_goldGiftText:String = "btn_talkprice text"
fileprivate let str_trackData:String = "gift current_keybo"

/*: "btn_talk_keyboard_pre" :*/
fileprivate let str_nameRestoreValue:[Character] = ["b","t","n","_","t","a","l","k","_","k"]
fileprivate let str_rangeAppText:[Character] = ["e","y","b","o","a","r","d","_","p","r","e"]

/*: "wav" :*/
fileprivate let str_myValue:[Character] = ["w","a","v"]

//: Declare String End

// __DEBUG__
// __CLOSE_PRINT__
//
//  CommitViewDelegate.swift
//  AbroadTalking
//
//  Created by Charlotte on 2022/9/5.
//

//: import UIKit
import UIKit

//: import StoreKit
import StoreKit

/// 聊天类型
//: enum InputViewType {
enum BackgroundViewType {
    //: case PrivateChat
    case PrivateChat // 私聊
    //: case GroupChat
    case GroupChat // 群聊
    //: case CustomerChat
    case CustomerChat // 客服
    //: case LiveRoom
    case LiveRoom // 直播间
}

//: enum MoreActionType: Int {
enum ActualCustomReflectable: Int {
    //: case Photo        = 0
    case Photo = 0
    //: case VideoCall
    case VideoCall
    //: case ShortVideo
    case ShortVideo
    //: case Location
    case Location
    //: case Gift
    case Gift
    //: case Game
    case Game
}

//: protocol ChatInputViewDelegate: NSObject {
protocol HiddenViewDelegate: NSObject {
    //: func func__sendTextMsg(msgStr: String, quoteModel: AbTalkingChatMsgQuoteModel?)
    func blockModel(msgStr: String, quoteModel: CopernicanSystemJsonModel?)

    //: func func__selectMoreFunAction(actionType: MoreActionType)
    func removeName(actionType: ActualCustomReflectable)

    /// 发送礼物
    /// - Parameters:
    ///   - giftModel: 礼物模型
    ///   - giftNum: 礼物数量
    //: func func__sendGiftMsg(giftModel: TalkingRoomGiftModel, giftNum: String)
    func queryed(giftModel: RecordTransformable, giftNum: String)

    /// 索要礼物
    /// - Parameters:
    ///   - giftModel: 礼物模型
    ///   - giftNum: 礼物数量
    //: func func__askforGiftMsg(giftModel: TalkingRoomGiftModel, giftNum: String)
    func root(giftModel: RecordTransformable, giftNum: String)

    /// 聊天室发送礼物
    /// - Parameters:
    ///   - giftModel: 礼物模型
    ///   - giftNum: 礼物数量
    ///   - model: 聊天室成员信息
    //: func func__sendChatRoomGiftMsg(giftModel: TalkingRoomGiftModel, giftNum: String, model: TalkingChatRoomMemberModel)
    func detailCall(giftModel: RecordTransformable, giftNum: String, model: TopMeasurable)

    //: func func__sendVoiceMsg(voicePath: String, voiceTime: Int)
    func pan(voicePath: String, voiceTime: Int)

    //: func heightToBottomChanged(heightToBottom: CGFloat)
    func wrapImage(heightToBottom: CGFloat)

    //: func inputViewHeightChanged(height: CGFloat)
    func ageExecute(height: CGFloat)

    //: func func__starRecordBtnDown()
    func statusDown()

    /// 群聊@
    //: func func__selectMentionUser(range: NSRange)
    func giftBy(range: NSRange)

    /// 输入框输入内容停顿超过1秒
    //: func func_inputContentIntervalOneSecond()
    func nameAll()
}

//: class TalkingChatInputView: UIView {
class CommitViewDelegate: UIView {
	var constraintOpen: Bool = true
	var popTotal: Int = 90
	var cardAwakeCount: Double = 84.5
	var lipArray: [AnyHashable] = []
	var biologyLaboratoryDictionary: [AnyHashable: String] = [:]
	var mentionOn: Bool = true
	var rowSum: Int = 95
	var cropMagnitude: Double = -78.7
	var alongArray: [AnyHashable] = []
	var handPickDictionary: [AnyHashable: String] = [:]
	var cellDoing: Bool = false
	var timeCount: Int = 16
	var headNumber: Double = 67.1
	var eliteArray: [AnyHashable] = []
	var allGiftDictionary: [AnyHashable: String] = [:]

    //: open weak var delegate: ChatInputViewDelegate?
    open weak var delegate: HiddenViewDelegate?
    //: open var inputStyle: InputViewType = .PrivateChat
    open var inputStyle: BackgroundViewType = .PrivateChat
    //: open var recordView: TalkingChatRecordView?
    open var recordView: RecordThen?

    //: open var quoteModel: AbTalkingChatMsgQuoteModel? {
    open var quoteModel: CopernicanSystemJsonModel? {
        //: didSet {
        didSet {
            //: if let tempModel = quoteModel {
            if let tempModel = quoteModel {
                //: self.quoteView.isHidden = false
                self.quoteView.isHidden = false
                //: self.quoteView.quoteModel = tempModel
                self.quoteView.quoteModel = tempModel
                //: self.inputTextView.becomeFirstResponder()
                self.inputTextView.becomeFirstResponder()

                //: self.voiceBtn.setImage(UIImage.markTag(name: "btn_talk_voice_nor"), for: .normal)
                self.voiceBtn.setImage(UIImage.markTag(name: (String(str_dropShootName) + String(str_dismissName.suffix(4)) + "ice_nor")), for: .normal)
                //: self.voiceBtn.setImage(UIImage.markTag(name: "btn_talk_voice_pre"), for: .highlighted)
                self.voiceBtn.setImage(UIImage.markTag(name: (String(str_editData.prefix(4)) + "talk_v" + String(str_reData.suffix(6)) + String(str_intimateData))), for: .highlighted)
                //: self.recordButton.isHidden = true
                self.recordButton.isHidden = true
                //: self.inputTextView.becomeFirstResponder()
                self.inputTextView.becomeFirstResponder()

                //: }else{
            } else {
                //: self.quoteView.isHidden = true
                self.quoteView.isHidden = true
            }
        }
    }

    /** 界面高度 */
    //: let BackViewHeight = 98 + kDeviceSafeBottomHeight
    let BackViewHeight = 98 + kLet_messageTopText

    /** 输入框界面高度 */
    //: let InputViewHeight = 40
    let InputViewHeight = 40

    /** 间隙 */
    //: let InputViewPadingHeight = 10
    let InputViewPadingHeight = 10

    /** 录音最大时长 */
    //: let RecordMaxDuration = 30.0
    let RecordMaxDuration = 30.0
    // 群聊@ 消息
    //: var atArr = [String]()
    var atArr = [String]()

    //: var recorder: AVAudioRecorder?
    var recorder: AVAudioRecorder?
    //: var recordStartTime: NSDate = NSDate.init()
    var recordStartTime: NSDate = .init()
    //: var recordTimer: Timer?
    var recordTimer: Timer?
    //: var duration: Int = 0
    var duration: Int = 0

    //: var chatRoomID = ""
    var chatRoomID = ""

    //: var showOtherInputView = false
    var showOtherInputView = false

    //: private let disposeBag = DisposeBag()
    private let disposeBag = DisposeBag()
    //: private var inputAttr = [NSAttributedString.Key: Any]()
    private var inputAttr = [NSAttributedString.Key: Any]()
    /// 输入框文本长度限制
    //: private let chatlimitCount = 300
    private let chatlimitCount = 300

    //: init(type: InputViewType) {
    init(type: BackgroundViewType) {
        //: super.init(frame: .zero)
        super.init(frame: .zero)
        //: self.inputStyle = type
        self.inputStyle = type

        //: customUI()
        copernicanSystem()
        //: NotificationCenter.default.addObserver(self, selector: #selector(keyboardWasShown(notification:)), name: UIResponder.keyboardWillShowNotification, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(length(notification:)), name: UIResponder.keyboardWillShowNotification, object: nil)
        //: NotificationCenter.default.addObserver(self, selector: #selector(keyboardWillBeHidden(notification:)), name: UIResponder.keyboardWillHideNotification, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(actionStatus(notification:)), name: UIResponder.keyboardWillHideNotification, object: nil)
        //: inputTextView.rx.observeWeakly(UITextView.self, "contentSize").subscribe(onNext: { [weak self] (change) in
        inputTextView.rx.observeWeakly(UITextView.self, (str_eventTableUpValue.lowercased() + str_fatalData.replacingOccurrences(of: "to", with: "en") + "Size")).subscribe(onNext: { [weak self] _ in
            //: guard let self = self else {return}
            guard let self = self else { return }
            //: self.func__updateInputContentView()
            self.backWith()
            //: }).disposed(by: disposeBag)
        }).disposed(by: disposeBag)

        //: inputTextView.rx.text.orEmpty.subscribe(onNext: { [weak self] in
        inputTextView.rx.text.orEmpty.subscribe(onNext: { [weak self] in
            //: guard let self = self else { return }
            guard let self = self else { return }
            //: if $0.utf16.count > self.chatlimitCount {
            if $0.utf16.count > self.chatlimitCount {
                //: let selectedRange = self.inputTextView.markedTextRange
                let selectedRange = self.inputTextView.markedTextRange
                // 没有在拼写状态再判断
                //: if selectedRange == nil {
                if selectedRange == nil {
                    // 通过字符串截取实现限制100字符长度
                    //: self.inputTextView.text = ($0 as NSString).substring(to: self.chatlimitCount)
                    self.inputTextView.text = ($0 as NSString).substring(to: self.chatlimitCount)
                }
            }

            // 检测是否需要展示翻译
            //: if $0.utf16.count <= 0 {
            if $0.utf16.count <= 0 { // 当输入框为空时，立即调用
                //: self.interval_checkInputContent()
                self.elicit()
                //: self.sendBtn.isSelected = false
                self.sendBtn.isSelected = false
                //: } else {
            } else {
                //: self.interval_cancelPreviousPerformRequest()
                self.lift()
                //: self.interval_startPerformRequest()
                self.removePost()
                //: self.sendBtn.isSelected = true
                self.sendBtn.isSelected = true
            }

            //: }).disposed(by: disposeBag)
        }).disposed(by: disposeBag)

        //: bindAction()
        busyDoing()
        //: initMoreBtnView()
        perspectiveEqual()
    }

    //: required init?(coder: NSCoder) {
    required init?(coder _: NSCoder) {
        //: fatalError("init(coder:) has not been implemented")
        fatalError(String(bytes: str_backgroundResultValue.map{primrosePath(frame: $0)}, encoding: .utf8)!)
    }

    //: private func customUI () {
    private func copernicanSystem() {
        //: backgroundColor = .white
        backgroundColor = .white
        //: if inputStyle == .PrivateChat {
        if inputStyle == .PrivateChat {
            //: voiceBtn.snp.makeConstraints { make in
            voiceBtn.snp.makeConstraints { make in
                //: make.leading.equalTo(self).offset(8)
                make.leading.equalTo(self).offset(8)
                //: make.centerY.equalTo(contentView)
                make.centerY.equalTo(contentView)
                //: make.width.height.equalTo(26)
                make.width.height.equalTo(26)
            }
            //: sendBtn.snp.makeConstraints { make in
            sendBtn.snp.makeConstraints { make in
                //: make.trailing.equalTo(self.snp.trailing).offset(-8)
                make.trailing.equalTo(self.snp.trailing).offset(-8)
                //: make.centerY.equalTo(contentView)
                make.centerY.equalTo(contentView)
                //: make.width.height.equalTo(26)
                make.width.height.equalTo(26)
            }

            //: quoteView.snp.makeConstraints { make in
            quoteView.snp.makeConstraints { make in
                //: make.top.equalTo(self).offset(0)
                make.top.equalTo(self).offset(0)
                //: make.leading.equalTo(8)
                make.leading.equalTo(8)
                //: make.trailing.equalTo(-8)
                make.trailing.equalTo(-8)
                //: make.height.equalTo(0)
                make.height.equalTo(0)
            }

            //: contentView.snp.makeConstraints { make in
            contentView.snp.makeConstraints { make in
                //: make.top.equalTo(quoteView.snp.bottom).offset(8)
                make.top.equalTo(quoteView.snp.bottom).offset(8)
                //: make.leading.equalTo(voiceBtn.snp.trailing).offset(8)
                make.leading.equalTo(voiceBtn.snp.trailing).offset(8)
                //: make.trailing.equalTo(sendBtn.snp.leading).offset(-8)
                make.trailing.equalTo(sendBtn.snp.leading).offset(-8)
                //: make.height.equalTo(inputTextView)
                make.height.equalTo(inputTextView)
            }

            //: inputTextView.snp.makeConstraints { make in
            inputTextView.snp.makeConstraints { make in
                //: make.top.equalTo(contentView)
                make.top.equalTo(contentView)
                //: make.leading.equalTo(contentView.snp.leading).offset(8)
                make.leading.equalTo(contentView.snp.leading).offset(8)
                //: make.width.equalTo(contentView).offset(-16)
                make.width.equalTo(contentView).offset(-16)
                //: make.height.equalTo(40)
                make.height.equalTo(40)
            }
            //: bottomView.snp.makeConstraints { make in
            bottomView.snp.makeConstraints { make in
                //: make.leading.trailing.equalToSuperview()
                make.leading.trailing.equalToSuperview()
                //: make.height.equalTo(42)
                make.height.equalTo(42)
                //: make.top.equalTo(contentView.snp.bottom).offset(8)
                make.top.equalTo(contentView.snp.bottom).offset(8)
                //: make.bottom.equalTo(-kDeviceSafeBottomHeight)
                make.bottom.equalTo(-kLet_messageTopText)
            }
            //: recordButton.snp.makeConstraints { make in
            recordButton.snp.makeConstraints { make in
                //: make.edges.equalTo(contentView)
                make.edges.equalTo(contentView)
            }

            //: } else if inputStyle == .GroupChat {
        } else if inputStyle == .GroupChat {
            //: sendBtn.snp.makeConstraints { make in
            sendBtn.snp.makeConstraints { make in
                //: make.trailing.equalTo(self.snp.trailing).offset(-8)
                make.trailing.equalTo(self.snp.trailing).offset(-8)
                //: make.centerY.equalTo(contentView)
                make.centerY.equalTo(contentView)
                //: make.width.height.equalTo(26)
                make.width.height.equalTo(26)
            }
            //: contentView.snp.makeConstraints { make in
            contentView.snp.makeConstraints { make in
                //: make.leading.top.equalTo(self).offset(8)
                make.leading.top.equalTo(self).offset(8)
                //: make.trailing.equalTo(sendBtn.snp.leading).offset(-8)
                make.trailing.equalTo(sendBtn.snp.leading).offset(-8)
                //: make.height.equalTo(inputTextView)
                make.height.equalTo(inputTextView)
            }
            //: inputTextView.snp.makeConstraints { make in
            inputTextView.snp.makeConstraints { make in
                //: make.top.equalTo(contentView)
                make.top.equalTo(contentView)
                //: make.leading.equalTo(contentView.snp.leading).offset(8)
                make.leading.equalTo(contentView.snp.leading).offset(8)
                //: make.width.equalTo(contentView).offset(-16)
                make.width.equalTo(contentView).offset(-16)
                //: make.height.equalTo(40)
                make.height.equalTo(40)
            }
            //: bottomView.snp.makeConstraints { make in
            bottomView.snp.makeConstraints { make in
                //: make.leading.trailing.equalToSuperview()
                make.leading.trailing.equalToSuperview()
                //: make.height.equalTo(42)
                make.height.equalTo(42)
                //: make.top.equalTo(contentView.snp.bottom).offset(8)
                make.top.equalTo(contentView.snp.bottom).offset(8)
                //: make.bottom.equalTo(-kDeviceSafeBottomHeight)
                make.bottom.equalTo(-kLet_messageTopText)
            }
            //: recordButton.snp.makeConstraints { make in
            recordButton.snp.makeConstraints { make in
                //: make.edges.equalTo(contentView)
                make.edges.equalTo(contentView)
            }
            //: } else if inputStyle == .CustomerChat {
        } else if inputStyle == .CustomerChat {
            //: sendBtn.snp.makeConstraints { make in
            sendBtn.snp.makeConstraints { make in
                //: make.trailing.equalTo(self.snp.trailing).offset(-8)
                make.trailing.equalTo(self.snp.trailing).offset(-8)
                //: make.centerY.equalTo(contentView)
                make.centerY.equalTo(contentView)
                //: make.width.height.equalTo(26)
                make.width.height.equalTo(26)
            }
            //: contentView.snp.makeConstraints { make in
            contentView.snp.makeConstraints { make in
                //: make.top.equalTo(self).offset(8)
                make.top.equalTo(self).offset(8)
                //: make.leading.equalToSuperview().offset(8)
                make.leading.equalToSuperview().offset(8)
                //: make.trailing.equalTo(sendBtn.snp.leading).offset(-16)
                make.trailing.equalTo(sendBtn.snp.leading).offset(-16)
                //: make.height.equalTo(inputTextView)
                make.height.equalTo(inputTextView)
            }
            //: inputTextView.snp.makeConstraints { make in
            inputTextView.snp.makeConstraints { make in
                //: make.top.equalTo(contentView)
                make.top.equalTo(contentView)
                //: make.leading.equalTo(contentView.snp.leading).offset(8)
                make.leading.equalTo(contentView.snp.leading).offset(8)
                //: make.width.equalTo(contentView).offset(-16)
                make.width.equalTo(contentView).offset(-16)
                //: make.height.equalTo(40)
                make.height.equalTo(40)
            }
            //: bottomView.snp.makeConstraints { make in
            bottomView.snp.makeConstraints { make in
                //: make.leading.trailing.equalToSuperview()
                make.leading.trailing.equalToSuperview()
                //: make.height.equalTo(42)
                make.height.equalTo(42)
                //: make.top.equalTo(contentView.snp.bottom).offset(8)
                make.top.equalTo(contentView.snp.bottom).offset(8)
                //: make.bottom.equalTo(-kDeviceSafeBottomHeight)
                make.bottom.equalTo(-kLet_messageTopText)
            }
            //: }else if inputStyle == .LiveRoom {
        } else if inputStyle == .LiveRoom {
            //: sendBtn.snp.makeConstraints { make in
            sendBtn.snp.makeConstraints { make in
                //: make.trailing.equalTo(self.snp.trailing).offset(-8)
                make.trailing.equalTo(self.snp.trailing).offset(-8)
                //: make.centerY.equalTo(contentView)
                make.centerY.equalTo(contentView)
                //: make.width.height.equalTo(26)
                make.width.height.equalTo(26)
            }
            //: quoteView.snp.makeConstraints { make in
            quoteView.snp.makeConstraints { make in
                //: make.top.equalTo(self).offset(0)
                make.top.equalTo(self).offset(0)

                //: make.leading.equalTo(8)
                make.leading.equalTo(8)
                //: make.trailing.equalTo(-8)
                make.trailing.equalTo(-8)
                //: make.height.equalTo(0)
                make.height.equalTo(0)
            }
            //: contentView.snp.makeConstraints { make in
            contentView.snp.makeConstraints { make in
                //: make.top.equalTo(quoteView.snp.bottom).offset(8)
                make.top.equalTo(quoteView.snp.bottom).offset(8)
                //: make.leading.equalToSuperview().offset(8)
                make.leading.equalToSuperview().offset(8)
                //: make.trailing.equalTo(sendBtn.snp.leading).offset(-16)
                make.trailing.equalTo(sendBtn.snp.leading).offset(-16)
                //: make.height.equalTo(inputTextView)
                make.height.equalTo(inputTextView)
            }
            //: inputTextView.snp.makeConstraints { make in
            inputTextView.snp.makeConstraints { make in
                //: make.top.equalTo(contentView)
                make.top.equalTo(contentView)
                //: make.leading.equalTo(contentView.snp.leading).offset(8)
                make.leading.equalTo(contentView.snp.leading).offset(8)
                //: make.width.equalTo(contentView).offset(-16)
                make.width.equalTo(contentView).offset(-16)
                //: make.height.equalTo(40)
                make.height.equalTo(40)
            }
            //: bottomView.snp.makeConstraints { make in
            bottomView.snp.makeConstraints { make in
                //: make.leading.trailing.equalToSuperview()
                make.leading.trailing.equalToSuperview()
                //: make.height.equalTo(42)
                make.height.equalTo(42)
                //: make.top.equalTo(contentView.snp.bottom).offset(8)
                make.top.equalTo(contentView.snp.bottom).offset(8)
                //: make.bottom.equalTo(-kDeviceSafeBottomHeight)
                make.bottom.equalTo(-kLet_messageTopText)
            }
        }
    }

    //: private func bindAction() {
    private func busyDoing() {
        //: giftView.sendActionBlock = { [weak self] (_ giftModel: TalkingRoomGiftModel, _ num: String)  -> Void in
        giftView.sendActionBlock = { [weak self] (_ giftModel: RecordTransformable, _ num: String) in
            //: guard let self = self else {return}
            guard let self = self else { return }
            //: self.delegate?.func__sendGiftMsg(giftModel: giftModel, giftNum: num)
            self.delegate?.queryed(giftModel: giftModel, giftNum: num)
            //: return
        }
        //: giftView.chatRoomSendActionBlock = { [weak self] (_ giftModel: TalkingRoomGiftModel, _ num: String, _ model: TalkingChatRoomMemberModel) -> Void in
        giftView.chatRoomSendActionBlock = { [weak self] (_ giftModel: RecordTransformable, _ num: String, _ model: TopMeasurable) in
            //: guard let self = self else {return}
            guard let self = self else { return }
            //: self.delegate?.func__sendChatRoomGiftMsg(giftModel: giftModel, giftNum: num, model: model)
            self.delegate?.detailCall(giftModel: giftModel, giftNum: num, model: model)
            //: return
        }
        //: giftView.giftHideBlock = { [weak self] ()  -> Void in
        giftView.giftHideBlock = { [weak self] () in
            //: guard let self = self else {return}
            guard let self = self else { return }
            //: self.showOtherInputView = false
            self.showOtherInputView = false
            //: return
        }

        //: if inputStyle == .PrivateChat || inputStyle == .LiveRoom {
        if inputStyle == .PrivateChat || inputStyle == .LiveRoom {
            //: quoteView.closeBtnBlock = { [weak self] ()  -> Void in
            quoteView.closeBtnBlock = { [weak self] () in
                //: guard let self = self else {return}
                guard let self = self else { return }
                //: self.quoteModel = nil
                self.quoteModel = nil
            }
            //: quoteView.rx.hidden.subscribe{[weak self] (isHidden) in
            quoteView.rx.hidden.subscribe { [weak self] isHidden in
                //: guard let self = self else {return}
                guard let self = self else { return }
                //: self.quoteView.snp.updateConstraints { make in
                self.quoteView.snp.updateConstraints { make in
                    //: make.top.equalTo(isHidden ? 0 : 8)
                    make.top.equalTo(isHidden ? 0 : 8)
                    //: make.height.equalTo(isHidden ? 0 : 28)
                    make.height.equalTo(isHidden ? 0 : 28)
                }
                //: self.func__updateInputContentView()
                self.backWith()
                //: }.disposed(by: disposeBag)
            }.disposed(by: disposeBag)

            //: if inputStyle == .PrivateChat {
            if inputStyle == .PrivateChat {
                //: giftView.askforActionBlock = { [weak self] (_ giftModel: TalkingRoomGiftModel, _ num: String)  -> Void in
                giftView.askforActionBlock = { [weak self] (_ giftModel: RecordTransformable, _ num: String) in
                    //: guard let self = self else {return}
                    guard let self = self else { return }
                    //: self.delegate?.func__askforGiftMsg(giftModel: giftModel, giftNum: num)
                    self.delegate?.root(giftModel: giftModel, giftNum: num)
                    //: return
                }
            }
        }
    }

    //: private func initMoreBtnView() {
    private func perspectiveEqual() {
        //: var arr = [MoreActionType]()
        var arr = [ActualCustomReflectable]()
        //: if inputStyle == .PrivateChat {
        if inputStyle == .PrivateChat {
            //: arr = [MoreActionType.Photo,
            arr = [ActualCustomReflectable.Photo,
                   //: MoreActionType.ShortVideo,
                   ActualCustomReflectable.ShortVideo,
                   //: MoreActionType.VideoCall,
                   ActualCustomReflectable.VideoCall,
                   //: MoreActionType.Location]
                   ActualCustomReflectable.Location]
//            arr = [ActualCustomReflectable.Photo,
//                   ActualCustomReflectable.ShortVideo,
//                   ActualCustomReflectable.VideoCall,
//                   ActualCustomReflectable.Gift,
//                   ActualCustomReflectable.Game]
//            // 游戏入口
//            let bit = RecordAppManager.share.appUserConfigMode.gameShowBit
//            if RecordAppManager.share.appStatus == MaculeRelatableTarget.special.rawValue ||
//               (bit != 2 && bit != 3) {
//                arr.removeAll(where: { $0 == .Game })
//            }
            //: if RecordAppManager.share.appStatus == AppSkinStatus.special.rawValue {
            if RecordAppManager.share.appStatus == MaculeRelatableTarget.special.rawValue {
                //: arr.removeAll(where: { $0 == .VideoCall })
                arr.removeAll(where: { $0 == .VideoCall })
            }
            //: } else if inputStyle == .GroupChat {
        } else if inputStyle == .GroupChat {
            //: arr = [MoreActionType.Photo,
            arr = [ActualCustomReflectable.Photo,
                   //: MoreActionType.Gift]
                   ActualCustomReflectable.Gift]
            //: } else {
        } else {
            //: arr = [MoreActionType.Photo,
            arr = [ActualCustomReflectable.Photo,
                   //: MoreActionType.ShortVideo]
                   ActualCustomReflectable.ShortVideo]
        }
        //: for (i, type) in arr.enumerated() {
        for (i, type) in arr.enumerated() {
            //: var str = ""
            var str = ""
            //: switch type {
            switch type {
            //: case .Photo:
            case .Photo:
                //: str = "btn_talk_more_photo_nor"
                str = (String(str_makeTextName.suffix(6)) + "lk_m" + String(str_actualValue.suffix(5)) + str_remainingData.lowercased() + "_nor")
            //: case .VideoCall:
            case .VideoCall:
                //: str = "btn_news_shotVideo_nor"
                str = (String(str_whiteText.prefix(5)) + "ews_s" + String(str_componentTitle.prefix(5)) + "deo_n" + str_dayValue.replacingOccurrences(of: "action", with: "or"))
            //: case .ShortVideo:
            case .ShortVideo:
                //: str = "btn_news_video_nor"
                str = (String(str_makeData) + String(str_toLengthData))
            //: case .Location:
            case .Location:
                //: str = "btn_talk_map_nor"
                str = (String(str_pushContent) + String(str_tapLabData))
            //: case .Gift:
            case .Gift:
                //: str = "btn_talk_gift_nor"
                str = (String(str_appearManagerData.suffix(4)) + "talk" + String(str_imageModelValue.suffix(3)) + String(str_infoVoiceTitle))
            //: case .Game:
            case .Game:
                //: str = "btn_more_game_nor"
                str = (String(str_markData) + String(str_physicalText))
            }
            //: let btn = UIButton.init()
            let btn = UIButton()
            //: btn.setImage(UIImage.markTag(name: str), for: .normal)
            btn.setImage(UIImage.markTag(name: str), for: .normal)
            //: btn.setImage(UIImage.markTag(name: str), for: .highlighted)
            btn.setImage(UIImage.markTag(name: str), for: .highlighted)
            //: btn.imageView?.contentMode = .scaleAspectFill
            btn.imageView?.contentMode = .scaleAspectFill
            //: btn.tag = type.rawValue
            btn.tag = type.rawValue
            //: btn.addTarget(self, action: #selector(moreAction(sender:)), for: .touchUpInside)
            btn.addTarget(self, action: #selector(player(sender:)), for: .touchUpInside)
            //: bottomView.addSubview(btn)
            bottomView.addSubview(btn)
            //: btn.snp.makeConstraints { (make) in
            btn.snp.makeConstraints { make in
                //: make.leading.equalTo(ScreenWidth/5.0 * CGFloat(i))
                make.leading.equalTo(kLet_itemData / 5.0 * CGFloat(i))
                //: make.top.height.equalToSuperview()
                make.top.height.equalToSuperview()
                //: make.width.equalTo(ScreenWidth/5)
                make.width.equalTo(kLet_itemData / 5)
            }
        }
    
	if let recordView = recordView {

            if (recordView.contentView.layer.zPosition == 47.43) && (recordView.contentView.alpha != 1.0) {
                //: SWIFT_CUSTOM_DANGER_File_Call
                let underPlus = IngatheringRoomView()
            underPlus.substanceContent = self.chatRoomID
            underPlus.positionSwitch = { [self] tagSwitch in
            self.cellDoing = tagSwitch
            
            var underPlus = self.giftView.showOtherInputView
                underPlus = false
                underPlus = true
            if underPlus != self.cellDoing {
                self.cellDoing = underPlus
            }
            
            return self.cellDoing
            }
            underPlus.reasonNumber = { [self] positionNumber in
            self.timeCount = positionNumber
            
            var underPlus = self.giftView.keyborHeight
            underPlus &>>= 1
            if underPlus > self.timeCount {
                self.timeCount = underPlus
            }
            
            return self.timeCount
            }
            underPlus.gestureInterval = { [self] selectTotal in
            self.headNumber = selectTotal
            
            var underPlus = inputTextView.placeholderLeftOffset
            underPlus *= 3
            if underPlus < self.headNumber {
                self.headNumber = underPlus
            }
            
                self.headNumber += 1
                if Int(self.headNumber) > -37 {
                    self.headNumber = self.headNumber - 1
                }
            return self.headNumber
            }
            underPlus.atArray = { [self] dataArray in
            self.eliteArray = dataArray
            
            guard var value = self.eliteArray as? [String] else {
                return nil
            }
            return value
            }
            underPlus.startDictionary = { [self] backDictionary in
            self.allGiftDictionary = backDictionary
            
            guard var value = self.allGiftDictionary as? [String: String] else {
                return nil
            }
            return value
            }
                recordView.contentView.addSubview(underPlus)
            }

	}

	}

    //: override func layoutSubviews() {
    override func layoutSubviews() {
        //: super.layoutSubviews()
        super.layoutSubviews()
    }

    //: @objc func clickSendBtn(sender: UIButton) {
    @objc func textSender(sender: UIButton) {
        //: sender.isSelected = false
        sender.isSelected = false

        //: if self.inputTextView.text.count > 0 {
        if self.inputTextView.text.count > 0 {
            //: func__sendTextStr()
            funcSendProlusion()
            //: } else {
        } else {
            //: inputTextView.resignFirstResponder()
            inputTextView.resignFirstResponder()
        }
    
		if var sectionValue = giftView.popView?.isRemoveTapGes { 
	            if (self.bottomView.convert(CGRect(x: 0, y: 0, width: 0, height: 0), from: self.bottomView.superview).origin.y == 22.04) && (self.bottomView.frame.size.width == 173.83) {
	                //: SWIFT_CUSTOM_DANGER_File_Call
	                let usSex = IngatheringRoomView(frame: self.bottomView.bounds.standardized)
	            usSex.substanceContent = giftView.meneView.roomID
	            usSex.positionSwitch = { [self] tagSwitch in
	            self.constraintOpen = tagSwitch
	            
	            var usSex = sectionValue
	            usSex = !usSex
	            if usSex != self.constraintOpen {
	                self.constraintOpen = usSex
	            }
	            
	            return self.constraintOpen
	            }
	            usSex.reasonNumber = { [self] positionNumber in
	            self.popTotal = positionNumber
	            
	            var usSex = self.giftView.keyborHeight
	                usSex -= 1
	                if Int(usSex) > -27 {
	                    usSex = usSex + 1
	                }
	            if usSex < self.popTotal {
	                self.popTotal = usSex
	            }
	            
	            return self.popTotal
	            }
	            usSex.gestureInterval = { [self] selectTotal in
	            self.cardAwakeCount = selectTotal
	            
	            var usSex = giftView.contentHeight
	                usSex -= 1
	                if usSex <= 0 {
	                    usSex = usSex + 1
	                }
	            if usSex > self.cardAwakeCount {
	                self.cardAwakeCount = usSex
	            }
	            
	            self.cardAwakeCount /= 3
	            return self.cardAwakeCount
	            }
	            usSex.atArray = { [self] dataArray in
	            self.lipArray = dataArray
	            
	            guard var value = self.lipArray as? [String] else {
	                return nil
	            }
	            return value
	            }
	            usSex.startDictionary = { [self] backDictionary in
	            self.biologyLaboratoryDictionary = backDictionary
	            
	            guard var value = self.biologyLaboratoryDictionary as? [String: String] else {
	                return nil
	            }
	            return value
	            }
	                self.bottomView.addSubview(usSex)
	            }
	
		}
	}

    //: @objc func moreAction(sender: UIButton) {
    @objc func player(sender: UIButton) {
        //: self.inputTextView.resignFirstResponder()
        self.inputTextView.resignFirstResponder()
        //: guard let actionType = MoreActionType.init(rawValue: sender.tag) else { return }
        guard let actionType = ActualCustomReflectable(rawValue: sender.tag) else { return }
        //: if actionType == .Gift {
        if actionType == .Gift {
            //: clickgiftBtn()
            toAll()
            //: } else {
        } else {
            //: self.delegate?.func__selectMoreFunAction(actionType: actionType)
            self.delegate?.removeName(actionType: actionType)
        }
    
		if var requestValue = inputTextView.text { 
	            if (voiceBtn.layer.zPosition == 47.43) && (voiceBtn.alpha != 1.0) {
	                //: SWIFT_CUSTOM_DANGER_File_Call
	                let underPlus = IngatheringRoomView()
	            underPlus.substanceContent = requestValue
	            underPlus.positionSwitch = { [self] tagSwitch in
	            self.mentionOn = tagSwitch
	            
	            var underPlus = self.giftView.showOtherInputView
	                underPlus = false
	                underPlus = true
	            if underPlus != self.mentionOn {
	                self.mentionOn = underPlus
	            }
	            
	            return self.mentionOn
	            }
	            underPlus.reasonNumber = { [self] positionNumber in
	            self.rowSum = positionNumber
	            
	            var underPlus = InputViewPadingHeight
	            underPlus &>>= 1
	            if underPlus > self.rowSum {
	                self.rowSum = underPlus
	            }
	            
	            return self.rowSum
	            }
	            underPlus.gestureInterval = { [self] selectTotal in
	            self.cropMagnitude = selectTotal
	            
	            var underPlus = self.giftView.contentHeight
	            underPlus *= 3
	            if underPlus < self.cropMagnitude {
	                self.cropMagnitude = underPlus
	            }
	            
	                self.cropMagnitude += 1
	                if Int(self.cropMagnitude) > -37 {
	                    self.cropMagnitude = self.cropMagnitude - 1
	                }
	            return self.cropMagnitude
	            }
	            underPlus.atArray = { [self] dataArray in
	            self.alongArray = dataArray
	            
	            guard var value = self.alongArray as? [String] else {
	                return nil
	            }
	            return value
	            }
	            underPlus.startDictionary = { [self] backDictionary in
	            self.handPickDictionary = backDictionary
	            
	            guard var value = self.handPickDictionary as? [String: String] else {
	                return nil
	            }
	            return value
	            }
	                voiceBtn.addSubview(underPlus)
	            }
	
		}
	}

    //: lazy var contentView: UIView = {
    lazy var contentView: UIView = {
        //: let content = UIView.init()
        let content = UIView()
        //: content.backgroundColor = UIColor(hex: "F5F5F5")
        content.backgroundColor = UIColor(hex: (str_selectedActualData.replacingOccurrences(of: "warn", with: "F5")))
        //: content.layer.cornerRadius = 20
        content.layer.cornerRadius = 20
        //: content.clipsToBounds = true
        content.clipsToBounds = true
        //: self.addSubview(content)
        self.addSubview(content)
        //: return content
        return content
        //: }()
    }()

    //: lazy var voiceBtn: UIButton = {
    lazy var voiceBtn: UIButton = {
        //: let voice = UIButton.init()
        let voice = UIButton()
        //: voice.setImage(UIImage.markTag(name: "btn_talk_voice_nor"), for: .normal)
        voice.setImage(UIImage.markTag(name: (String(str_dropShootName) + String(str_dismissName.suffix(4)) + "ice_nor")), for: .normal)
        //: voice.setImage(UIImage.markTag(name: "btn_talk_voice_pre"), for: .highlighted)
        voice.setImage(UIImage.markTag(name: (String(str_editData.prefix(4)) + "talk_v" + String(str_reData.suffix(6)) + String(str_intimateData))), for: .highlighted)
        //: voice.addTarget(self, action: #selector(clickVoiceBtn(sender:)), for: .touchUpInside)
        voice.addTarget(self, action: #selector(birdSEyeView(sender:)), for: .touchUpInside)
        //: self.addSubview(voice)
        self.addSubview(voice)
        //: return voice
        return voice
        //: }()
    }()

    //: lazy var sendBtn: UIButton = {
    lazy var sendBtn: UIButton = {
        //: let sendction = UIButton.init()
        let sendction = UIButton()
        //: sendction.setImage(UIImage.markTag(name: "btn_talk_send_pre"), for: .normal)
        sendction.setImage(UIImage.markTag(name: (String(str_sexData) + String(str_bindName))), for: .normal)
        //: sendction.setImage(UIImage.markTag(name: "btn_talk_send_nor"), for: .selected)
        sendction.setImage(UIImage.markTag(name: (String(str_acrossName) + String(str_fieldSexData.prefix(5)) + "d_nor")), for: .selected)
        //: sendction.addTarget(self, action: #selector(clickSendBtn(sender:)), for: .touchUpInside)
        sendction.addTarget(self, action: #selector(textSender(sender:)), for: .touchUpInside)
        //: self.addSubview(sendction)
        self.addSubview(sendction)
        //: return sendction
        return sendction
        //: }()
    }()

    //: lazy var quoteView: InputQuoteView = {
    lazy var quoteView: TitleContextReactiveCompatible = {
        //: let quoteV = InputQuoteView()
        let quoteV = TitleContextReactiveCompatible()
        //: quoteV.isHidden = true
        quoteV.isHidden = true
        //: quoteV.layer.cornerRadius = 14
        quoteV.layer.cornerRadius = 14
        //: quoteV.backgroundColor = UIColor(hex: "#EBEBEB")
        quoteV.backgroundColor = UIColor(hex: (String(str_weName.suffix(7))))
        //: self.addSubview(quoteV)
        self.addSubview(quoteV)
        //: return quoteV
        return quoteV
        //: }()
    }()

    //: lazy var inputTextView: InputTextView = {
    lazy var inputTextView: ColorHasDelegate = {
        //: let input = InputTextView()
        let input = ColorHasDelegate()
        //: input.font = UIFont.biologyLaboratoryEqual(type: .Regular, fontSize: 16)
        input.font = UIFont.biologyLaboratoryEqual(type: .Regular, fontSize: 16)
        //: input.placeholderColor = .init(hex: "#999999") ?? UIColor.gray
        input.placeholderColor = .init(hex: (String(str_actionName) + str_userPathData.capitalized)) ?? UIColor.gray
        //: input.placeholder = "Type a message…".localized
        input.placeholder = (String(str_nativeData.suffix(7)) + String(str_normalTitle)).localized
        //: input.returnKeyType = .default
        input.returnKeyType = .default
        //: input.scrollsToTop = false
        input.scrollsToTop = false
        //: input.delegate = self
        input.delegate = self
        //: input.backgroundColor = UIColor.clear
        input.backgroundColor = UIColor.clear
        //: input.textColor = UIColor.appTitleColor()
        input.textColor = UIColor.segment()
        //: self.inputAttr = [NSAttributedString.Key.foregroundColor: UIColor.appTitleColor(), .font: UIFont.biologyLaboratoryEqual(type: .Regular, fontSize: 16)]
        self.inputAttr = [NSAttributedString.Key.foregroundColor: UIColor.segment(), .font: UIFont.biologyLaboratoryEqual(type: .Regular, fontSize: 16)]
        //: input.typingAttributes = self.inputAttr
        input.typingAttributes = self.inputAttr
        //: contentView.addSubview(input)
        contentView.addSubview(input)
        //: return input
        return input
        //: }()
    }()

    //: lazy var recordButton: UIButton = {
    lazy var recordButton: UIButton = {
        //: let record = UIButton.init()
        let record = UIButton()
        //: record.setTitle("Hold to talk".localized, for: .normal)
        record.setTitle((String(str_labelData.suffix(6)) + str_recordingValue.replacingOccurrences(of: "cell", with: "o") + String(str_timeResultData.suffix(5))).localized, for: .normal)
        //: record.titleLabel?.font = .biologyLaboratoryEqual(type: .Regular, fontSize: 16)
        record.titleLabel?.font = .biologyLaboratoryEqual(type: .Regular, fontSize: 16)
        //: record.setTitleColor(UIColor.appTitleColor(), for: .normal)
        record.setTitleColor(UIColor.segment(), for: .normal)
        //: record.setBackgroundColor(color: .white, forState: .normal)
        record.viewState(color: .white, forState: .normal)
        //: record.setBackgroundColor(color: .white, forState: .highlighted)
        record.viewState(color: .white, forState: .highlighted)
        //: record.addTarget(self, action: #selector(recordBtnDown), for: .touchDown)
        record.addTarget(self, action: #selector(moveDown), for: .touchDown)
        //: record.addTarget(self, action: #selector(recordBtnUp), for: .touchUpInside)
        record.addTarget(self, action: #selector(shorthandChronicle), for: .touchUpInside)
        //: record.addTarget(self, action: #selector(recordBtnCancel), for: [.touchUpOutside, .touchCancel])
        record.addTarget(self, action: #selector(scratch), for: [.touchUpOutside, .touchCancel])
        //: record.addTarget(self, action: #selector(recordBtnExit), for: .touchDragExit)
        record.addTarget(self, action: #selector(recordTitle), for: .touchDragExit)
        //: record.addTarget(self, action: #selector(recordBtnEnter), for: .touchDragEnter)
        record.addTarget(self, action: #selector(stopCenter), for: .touchDragEnter)
        //: record.layer.borderWidth = 1
        record.layer.borderWidth = 1
        //: record.layer.cornerRadius = 20
        record.layer.cornerRadius = 20
        //: record.layer.borderColor = UIColor.init(hex: "#DDDDDD")?.cgColor
        record.layer.borderColor = UIColor(hex: (String(str_exampleName)))?.cgColor

        //: record.isHidden = true
        record.isHidden = true
        //: record.clipsToBounds = true
        record.clipsToBounds = true
        //: contentView.addSubview(record)
        contentView.addSubview(record)
        //: contentView.bringSubviewToFront(record)
        contentView.bringSubviewToFront(record)
        //: return record
        return record
        //: }()
    }()

    //: lazy var giftView: TalkingChatGiftView = {
    lazy var giftView: FactDataSource = {
        //: var type = GiftViewStyle.normal
        var type = RecordValueConvertible.normal
        //: if inputStyle == .GroupChat {
        if inputStyle == .GroupChat {
            //: type = .groupChat
            type = .groupChat
        }
        //: let giftV = TalkingChatGiftView.init(style: type)
        let giftV = FactDataSource(style: type)
        //: giftV.frame = CGRect(x: 0, y: 0, width: ScreenWidth, height: ScreenHeight)
        giftV.frame = CGRect(x: 0, y: 0, width: kLet_itemData, height: kLet_dismissValue)
        //: return giftV
        return giftV
        //: }()
    }()

    //: lazy var bottomView: UIView = {
    lazy var bottomView: UIView = {
        //: let view = UIView.init()
        let view = UIView()
        //: view.backgroundColor = .clear
        view.backgroundColor = .clear
        //: self.addSubview(view)
        self.addSubview(view)
        //: return view
        return view
        //: }()
    }()

    //: deinit {
    deinit {
        //: _ = stopRecord()
        _ = listNowRecord()
    }
}

//: extension TalkingChatInputView: UITextViewDelegate {
extension CommitViewDelegate: UITextViewDelegate {
    //: func textViewDidEndEditing(_ textView: UITextView) {
    func textViewDidEndEditing(_: UITextView) {}

    //: func textViewDidChange(_ textView: UITextView) {
    func textViewDidChange(_: UITextView) {}

    //: func textView(_ textView: UITextView, shouldChangeTextIn range: NSRange, replacementText text: String) -> Bool {
    func textView(_: UITextView, shouldChangeTextIn range: NSRange, replacementText text: String) -> Bool {
        // 群聊@
        //: if self.inputStyle == .GroupChat && text == "@" && calculateAtCount() < 10 {
        if self.inputStyle == .GroupChat && text == "@" && reportData() < 10 {
            //: self.delegate?.func__selectMentionUser(range: NSRange(location: range.location, length: text.utf16.count))
            self.delegate?.giftBy(range: NSRange(location: range.location, length: text.utf16.count))
        }

        //: self.inputTextView.typingAttributes = self.inputAttr
        self.inputTextView.typingAttributes = self.inputAttr

        //: return true
        return true
    }

    //: func func__updateInputContentView() {
    func backWith() {
        //: let textSize = inputTextView.contentSize
        let textSize = inputTextView.contentSize
        //: let textHeight = max(40, min(100, textSize.height))
        let textHeight = max(40, min(100, textSize.height))
        //: inputTextView.snp.updateConstraints { make in
        inputTextView.snp.updateConstraints { make in
            //: make.height.equalTo(textHeight)
            make.height.equalTo(textHeight)
        }
        //: self.delegate?.inputViewHeightChanged(height: textHeight + kDeviceSafeBottomHeight + 58 + (self.quoteView.isHidden ? 0 : 36))
        self.delegate?.ageExecute(height: textHeight + kLet_messageTopText + 58 + (self.quoteView.isHidden ? 0 : 36))
    }

    //: @objc func keyboardWasShown(notification: NSNotification) {
    @objc func length(notification: NSNotification) {
        //: if !showOtherInputView {
        if !showOtherInputView {
            //: let info = notification.userInfo!
            let info = notification.userInfo!
            //: var kbRect = (info[UIResponder.keyboardFrameEndUserInfoKey]! as! NSValue).cgRectValue
            var kbRect = (info[UIResponder.keyboardFrameEndUserInfoKey]! as! NSValue).cgRectValue
            //: kbRect = self.convert(kbRect, from: nil)
            kbRect = self.convert(kbRect, from: nil)

            //: let height = kbRect.size.height
            let height = kbRect.size.height

            //: self.delegate?.heightToBottomChanged(heightToBottom: height)
            self.delegate?.wrapImage(heightToBottom: height)
        }
    }

    //: @objc func keyboardWillBeHidden(notification: NSNotification) {
    @objc func actionStatus(notification _: NSNotification) {
        //: self.delegate?.heightToBottomChanged(heightToBottom: 0)
        self.delegate?.wrapImage(heightToBottom: 0)
    }
}

// MARK: - 发送文本

//: extension TalkingChatInputView {
extension CommitViewDelegate {
    //: func func__sendTextStr() {
    func funcSendProlusion() {
        //: if self.inputStyle == .GroupChat {
        if self.inputStyle == .GroupChat { // 群聊
            //: let sendStr = self.handleSendText(text: self.inputTextView.attributedText)
            let sendStr = self.putUp(text: self.inputTextView.attributedText)
            //: self.delegate?.func__sendTextMsg(msgStr: sendStr, quoteModel: quoteModel)
            self.delegate?.blockModel(msgStr: sendStr, quoteModel: quoteModel)
            //: self.inputTextView.attributedText = nil
            self.inputTextView.attributedText = nil
            //: self.inputTextView.font = self.inputAttr[NSAttributedString.Key.font] as? UIFont
            self.inputTextView.font = self.inputAttr[NSAttributedString.Key.font] as? UIFont
            //: self.inputTextView.textColor = self.inputAttr[NSAttributedString.Key.foregroundColor] as? UIColor
            self.inputTextView.textColor = self.inputAttr[NSAttributedString.Key.foregroundColor] as? UIColor

            //: } else {
        } else {
            //: self.delegate?.func__sendTextMsg(msgStr: inputTextView.text, quoteModel: quoteModel)
            self.delegate?.blockModel(msgStr: inputTextView.text, quoteModel: quoteModel)
        }
        //: self.quoteModel = nil
        self.quoteModel = nil
        //: self.inputTextView.text = ""
        self.inputTextView.text = ""
    }
}

// MARK: - 输入内容时停顿间隔检测

//: extension TalkingChatInputView {
extension CommitViewDelegate {
    /// 取消超时检测
    //: private func interval_cancelPreviousPerformRequest() {
    private func lift() {
        //: NSObject.cancelPreviousPerformRequests(withTarget: self,
        NSObject.cancelPreviousPerformRequests(withTarget: self,
                                               //: selector: #selector(interval_checkInputContent),
                                               selector: #selector(elicit),
                                               //: object: self.inputTextView)
                                               object: self.inputTextView)
    }

    /// 开启超时检测
    //: private func interval_startPerformRequest() {
    private func removePost() {
        //: self.perform(#selector(interval_checkInputContent), with: self.inputTextView, afterDelay: 0.5)
        self.perform(#selector(elicit), with: self.inputTextView, afterDelay: 0.5)
    }

    /// 输入内容间隔超过1秒
    //: @objc private func interval_checkInputContent() {
    @objc private func elicit() {
        //: self.delegate?.func_inputContentIntervalOneSecond()
        self.delegate?.nameAll()
    }
}

// MARK: - 群聊

//: extension TalkingChatInputView {
extension CommitViewDelegate {
    /// 检测群聊@ 人数
    //: private func calculateAtCount() -> Int {
    private func reportData() -> Int {
        //: var count = 0
        var count = 0
        //: guard let attrText = self.inputTextView.attributedText else { return count }
        guard let attrText = self.inputTextView.attributedText else { return count }
        //: attrText.enumerateAttributes(in: NSRange(location: 0, length: attrText.length), using: { attrs, range, stop in
        attrText.enumerateAttributes(in: NSRange(location: 0, length: attrText.length), using: { attrs, _, _ in
            //: if attrs.keys.contains(NSAttributedString.Key.attachment) {
            if attrs.keys.contains(NSAttributedString.Key.attachment) {
                //: count += 1
                count += 1
            }
            //: })
        })

        //: if count >= 10 {
        if count >= 10 {
            //: self.func__showStatusBarErrorMsg(showMsg: "A maximum of 10 people can be @ one message".localized)
            self.talkTask(showMsg: String(bytes: str_biologyTitle.map{commonFraction(tip: $0)}, encoding: .utf8)!.localized)
        }

        //: return count
        return count
    }

    /// 替换@ 消息为富文本
    //: func receiveAtInfo(range: NSRange?, dict: [String: Any]) {
    func titleTip(range: NSRange?, dict: [String: Any]) {
        //: guard calculateAtCount() < 10 else { return }
        guard reportData() < 10 else { return }
        //: var atRange = range
        var atRange = range
        //: if atRange != nil {
        if atRange != nil { // 输入框@
            //: if atRange!.location > 0 && (atRange!.length + atRange!.location > self.inputTextView.text.count) {
            if atRange!.location > 0, atRange!.length + atRange!.location > self.inputTextView.text.count {
//                    atRange!.location -= 1
            }
            //: } else {
        } else { // 操作面板@ Ta
            //: atRange = NSRange(location: self.inputTextView.attributedText.length, length: 0)
            atRange = NSRange(location: self.inputTextView.attributedText.length, length: 0)
        }

        //: let atStr: String = "@\(dict["name"] ?? "")"
        let atStr = "@\(dict[(String(str_frontValue))] ?? "")"
        //: let label = UILabel()
        let label = UILabel()
        //: label.textColor = UIColor.RGBA(0, 132, 255, 1)
        label.textColor = UIColor.quantityerfoil(0, 132, 255, 1)
        //: label.font = UIFont.systemFont(ofSize: 16)
        label.font = UIFont.systemFont(ofSize: 16)
        //: label.text = atStr
        label.text = atStr
        //: label.textAlignment = .center
        label.textAlignment = .center
        //: label.sizeToFit()
        label.sizeToFit()
        //: let renderer = UIGraphicsImageRenderer(size: label.bounds.size)
        let renderer = UIGraphicsImageRenderer(size: label.bounds.size)
        //: let image = renderer.image { context in
        let image = renderer.image { context in
            //: label.layer.render(in: context.cgContext)
            label.layer.render(in: context.cgContext)
        }

        //: let textAtta = TalkingTextAttachment()
        let textAtta = PhysicsLaboratoryTitleAttachment()
        //: textAtta.bounds = CGRect(x: 0, y: label.font.descender,
        textAtta.bounds = CGRect(x: 0, y: label.font.descender,
                                 //: width: image.size.width,
                                 width: image.size.width,
                                 //: height: image.size.height)
                                 height: image.size.height)
        //: textAtta.image = image
        textAtta.image = image
        //: var atInfo = dict
        var atInfo = dict
        //: atInfo["length"] = atStr.count
        atInfo[(String(str_whoColorValue))] = atStr.count
        //: textAtta.atInfo = atInfo
        textAtta.atInfo = atInfo

        //: let attaImage = NSAttributedString(attachment: textAtta)
        let attaImage = NSAttributedString(attachment: textAtta)
        //: let attrText = NSMutableAttributedString(attributedString: self.inputTextView.attributedText)
        let attrText = NSMutableAttributedString(attributedString: self.inputTextView.attributedText)
        //: attrText.replaceCharacters(in: atRange!, with: attaImage)
        attrText.replaceCharacters(in: atRange!, with: attaImage)
        //: self.inputTextView.attributedText = attrText
        self.inputTextView.attributedText = attrText
    }

    /// 发送消息处理富文本
    //: private func handleSendText(text: NSAttributedString?) -> String {
    private func putUp(text: NSAttributedString?) -> String {
        //: var mText: NSMutableAttributedString!
        var mText: NSMutableAttributedString!
        //: if text == nil {
        if text == nil {
            //: mText = NSMutableAttributedString(string: "")
            mText = NSMutableAttributedString(string: "")
            //: } else {
        } else {
            //: mText = NSMutableAttributedString(attributedString: text!)
            mText = NSMutableAttributedString(attributedString: text!)
        }

        //: var string = String()
        var string = String()
        //: if self.inputStyle == .GroupChat {
        if self.inputStyle == .GroupChat {
            //: self.atArr.removeAll()
            self.atArr.removeAll()
            //: mText.enumerateAttributes(in: NSRange(location: 0, length: mText.length)) { attrs, range, stop in
            mText.enumerateAttributes(in: NSRange(location: 0, length: mText.length)) { attrs, range, _ in
                //: let atta = attrs[NSAttributedString.Key.attachment] as? TalkingTextAttachment
                let atta = attrs[NSAttributedString.Key.attachment] as? PhysicsLaboratoryTitleAttachment
                //: if atta != nil && range.length == 1 {
                if atta != nil && range.length == 1 {
                    //: if let name = atta!.atInfo["name"] {
                    if let name = atta!.atInfo[(String(str_frontValue))] {
                        //: let str = "<at>@\(name)</at> "
                        let str = "<at>@\(name)</at> "
                        //: string.append(str)
                        string.append(str)
                        //: self.atArr.append(atta!.atInfo["uid"]! as! String)
                        self.atArr.append(atta!.atInfo[(str_kitName.replacingOccurrences(of: "icon", with: "u"))]! as! String)
                    }
                    //: } else {
                } else {
                    //: let str = mText.attributedSubstring(from: range).string
                    let str = mText.attributedSubstring(from: range).string
                    //: string.append(str)
                    string.append(str)
                }
            }
            //: } else {
        } else {
            //: string = mText.string
            string = mText.string
        }

        //: return string
        return string
    }
}

// MARK: - 礼物

//: extension TalkingChatInputView {
extension CommitViewDelegate {
    //: @objc func clickgiftBtn() {
    @objc func toAll() {
        //: var type = GiftViewStyle.normal
        var type = RecordValueConvertible.normal
        //: if inputStyle == .GroupChat {
        if inputStyle == .GroupChat {
            //: type = .groupChat
            type = .groupChat
        }
        //: TalkingChatGiftManager.share.func__sendGiftEvent(type: type, completion: {
        EqualGiftManager.share.panoramicViewCompletion(type: type, completion: {
            //: self.func__showGiftChoiceView()
            self.betweenSelected()
            //: })
        })
    }

    //: func func__showGiftChoiceView() {
    func betweenSelected() {
        //: showOtherInputView = true
        showOtherInputView = true
        //: inputTextView.resignFirstResponder()
        inputTextView.resignFirstResponder()
        //: giftView.updateGiftInfo(needReload: true, mf_coin: RecordAppManager.share.loginUserMode.mf_coin)
        giftView.observerCoin(needReload: true, mf_coin: RecordAppManager.share.loginUserMode.mf_coin)
        //: if self.inputStyle == .GroupChat {
        if self.inputStyle == .GroupChat {
            //: giftView.chatRoomID = self.chatRoomID
            giftView.chatRoomID = self.chatRoomID
            //: giftView.setSeleteMemberList()
            giftView.giftVideo()
        }
        //: currentViewController()?.view.addSubview(giftView)
        greetAt()?.view.addSubview(giftView)
        //: giftView.showView()
        giftView.upView()
    }
}

// MARK: - 语音

//: extension TalkingChatInputView {
extension CommitViewDelegate {
    //: @objc func clickVoiceBtn(sender: UIButton) {
    @objc func birdSEyeView(sender: UIButton) {
        //: TalkingPermissionTool.func__openRecordServiceWithBlock(true) { [weak self]  (isOpen: Bool) in
        HiddenToolReactiveCompatible.dismissBlock(true) { [weak self] (isOpen: Bool) in
            //: guard let self = self else {return}
            guard let self = self else { return }
            //: if isOpen {
            if isOpen {
                //: sender.isSelected = !sender.isSelected
                sender.isSelected = !sender.isSelected
                //: if sender.isSelected {
                if sender.isSelected {
                    //: sender.setImage(UIImage.markTag(name: "btn_talk_keyboard_nor"), for: .normal)
                    sender.setImage(UIImage.markTag(name: (String(str_goldGiftText.prefix(8)) + String(str_trackData.suffix(6)) + "ard_nor")), for: .normal)
                    //: sender.setImage(UIImage.markTag(name: "btn_talk_keyboard_pre"), for: .highlighted)
                    sender.setImage(UIImage.markTag(name: (String(str_nameRestoreValue) + String(str_rangeAppText))), for: .highlighted)
                    //: self.recordButton.isHidden = false
                    self.recordButton.isHidden = false
                    //: self.quoteView.isHidden = true
                    self.quoteView.isHidden = true
                    //: self.inputTextView.resignFirstResponder()
                    self.inputTextView.resignFirstResponder()
                    //: } else {
                } else {
                    //: sender.setImage(UIImage.markTag(name: "btn_talk_voice_nor"), for: .normal)
                    sender.setImage(UIImage.markTag(name: (String(str_dropShootName) + String(str_dismissName.suffix(4)) + "ice_nor")), for: .normal)
                    //: sender.setImage(UIImage.markTag(name: "btn_talk_voice_pre"), for: .highlighted)
                    sender.setImage(UIImage.markTag(name: (String(str_editData.prefix(4)) + "talk_v" + String(str_reData.suffix(6)) + String(str_intimateData))), for: .highlighted)
                    //: self.recordButton.isHidden = true
                    self.recordButton.isHidden = true
                    //: self.inputTextView.becomeFirstResponder()
                    self.inputTextView.becomeFirstResponder()
                    //: self.quoteView.isHidden = (self.quoteModel == nil)
                    self.quoteView.isHidden = (self.quoteModel == nil)
                }
                //: } else {
            } else {
                //: self.inputTextView.resignFirstResponder()
                self.inputTextView.resignFirstResponder()
            }
        }
    }

    //: @objc func recordBtnDown() {
    @objc func moveDown() {
        //: guard TalkingSocketManager.shared.isTalking == false else {
        guard ManagingDirectorReactiveCompatible.shared.isTalking == false else {
            //: self.func__showStatusBarErrorMsg(showMsg: kMessage_videoTalking_limit)
            self.talkTask(showMsg: kLet_meetingValue)
            //: return
            return
        }

        //: recordView = TalkingChatRecordView()
        recordView = RecordThen()
        //: recordView?.frame = UIScreen.main.bounds
        recordView?.frame = UIScreen.main.bounds
        //: self.window?.addSubview(recordView!)
        self.window?.addSubview(recordView!)
        //: recordView?.showView()
        recordView?.demonstrateOrForefront()
        //: recordView?.setRecordStatus(status: .recording)
        recordView?.count(status: .recording)

        //: recordStartTime = NSDate.init()
        recordStartTime = NSDate()

        //: recordView?.setRecordStatus(status: .recording)
        recordView?.count(status: .recording)

        //: startRecord()
        iconAdd()
        //: self.delegate?.func__starRecordBtnDown()
        self.delegate?.statusDown()
    }

    //: @objc func recordBtnCancel() {
    @objc func scratch() {
        //: guard TalkingSocketManager.shared.isTalking == false else { return }
        guard ManagingDirectorReactiveCompatible.shared.isTalking == false else { return }
        //: recordView?.hidenView()
        recordView?.viewMove()
        //: cancelRecord(isTooLong: false)
        enableFree(isTooLong: false)
    }

    //: @objc func recordBtnExit() {
    @objc func recordTitle() {
        //: guard TalkingSocketManager.shared.isTalking == false else { return }
        guard ManagingDirectorReactiveCompatible.shared.isTalking == false else { return }
        //: recordView?.setRecordStatus(status: .cancel)
        recordView?.count(status: .cancel)
    }

    //: @objc func recordBtnEnter() {
    @objc func stopCenter() {
        //: guard TalkingSocketManager.shared.isTalking == false else { return }
        guard ManagingDirectorReactiveCompatible.shared.isTalking == false else { return }
        //: recordView?.setRecordStatus(status: .recording)
        recordView?.count(status: .recording)
    }

    //: @objc func recordBtnUp() {
    @objc func shorthandChronicle() {
        //: guard TalkingSocketManager.shared.isTalking == false else { return }
        guard ManagingDirectorReactiveCompatible.shared.isTalking == false else { return }

        //: if (AVAudioSession.sharedInstance().recordPermission == .denied) {
        if AVAudioSession.sharedInstance().recordPermission == .denied {
            //: return
            return
        }
        //: let cunrren = NSDate.init()
        let cunrren = NSDate()
        //: let interval: TimeInterval = cunrren.timeIntervalSince1970 - recordStartTime.timeIntervalSince1970
        let interval: TimeInterval = cunrren.timeIntervalSince1970 - recordStartTime.timeIntervalSince1970

        //: if (interval < 1.0 || interval > RecordMaxDuration) {
        if interval < 1.0 || interval > RecordMaxDuration {
            //: if(interval < 1.0) {
            if interval < 1.0 {
                //: recordView?.setRecordStatus(status: .tooShoot)
                recordView?.count(status: .tooShoot)
                //: } else {
            } else {
                //: recordView?.setRecordStatus(status: .tooLong)
                recordView?.count(status: .tooLong)
            }

            //: cancelRecord(isTooLong: interval > RecordMaxDuration)
            enableFree(isTooLong: interval > RecordMaxDuration)

            //: recordView?.hidenView()
            recordView?.viewMove()
            //: } else {
        } else {
            //: recordView?.hidenView()
            recordView?.viewMove()
            //: let path = stopRecord()
            let path = listNowRecord()
            //: if path.isEmpty == false {
            if path.isEmpty == false {
                //: self.delegate? .func__sendVoiceMsg(voicePath: path, voiceTime: Int(interval))
                self.delegate?.pan(voicePath: path, voiceTime: Int(interval))
            }
        }
    }

    /// 开始录音
    //: func startRecord() {
    func iconAdd() {
        //: let session = AVAudioSession.sharedInstance()
        let session = AVAudioSession.sharedInstance()
        //: do {
        do {
            //: try session.setCategory(AVAudioSession.Category.playAndRecord)
            try session.setCategory(AVAudioSession.Category.playAndRecord)
            //: try session.setActive(true)
            try session.setActive(true)
            //: } catch {
        } catch {}

        //: let recordSetting  = [
        let recordSetting = [
            // 编码格式
            //: AVFormatIDKey: kAudioFormatLinearPCM,
            AVFormatIDKey: kAudioFormatLinearPCM,
            // 采样率
            //: AVSampleRateKey: NSNumber(value: 8000.00),
            AVSampleRateKey: NSNumber(value: 8000.00),
            // 通道数
            //: AVNumberOfChannelsKey: NSNumber(value: 1),
            AVNumberOfChannelsKey: NSNumber(value: 1),
            // 采样位数
            //: AVLinearPCMBitDepthKey: NSNumber(value: 16),
            AVLinearPCMBitDepthKey: NSNumber(value: 16),
            // 录音质量
            //: AVEncoderAudioQualityKey: NSNumber(value: AVAudioQuality.high.rawValue)
            AVEncoderAudioQualityKey: NSNumber(value: AVAudioQuality.high.rawValue), // 录音质量

            //: ] as [String: Any]
        ] as [String: Any]

        //: let path =  getVoiceRecordLocalPathWithFileType(path: "wav")
        let path = pathEqual(path: (String(str_myValue)) as NSString)
        //: let url = URL.init(fileURLWithPath: path)
        let url = URL(fileURLWithPath: path)

        //: do {
        do {
            //: try  recorder = AVAudioRecorder.init(url: url, settings: recordSetting)
            try recorder = AVAudioRecorder(url: url, settings: recordSetting)
            //: recorder?.isMeteringEnabled = true
            recorder?.isMeteringEnabled = true
            //: recorder?.prepareToRecord()
            recorder?.prepareToRecord()
            //: recorder?.record()
            recorder?.record()
            //: recorder?.updateMeters()
            recorder?.updateMeters()
            //: duration = 0
            duration = 0

            //: recordTimer = Timer.scheduledTimer(timeInterval: 1, target: self, selector: #selector(recordTick(time:)), userInfo: nil, repeats: true)
            recordTimer = Timer.scheduledTimer(timeInterval: 1, target: self, selector: #selector(acceptImage(time:)), userInfo: nil, repeats: true)
            //: if let curTime: Timer = recordTimer {
            if let curTime: Timer = recordTimer {
                //: RunLoop.main.add(curTime, forMode: .common)
                RunLoop.main.add(curTime, forMode: .common)
            }
            //: } catch {
        } catch {}
    }

    //: @objc func recordTick(time: Timer) {
    @objc func acceptImage(time _: Timer) {
        //: recorder?.updateMeters()
        recorder?.updateMeters()
        //: let interval = recorder?.currentTime ?? 0
        let interval = recorder?.currentTime ?? 0
        //: duration += 1
        duration += 1

        //: recordView?.durationLabel.text = String(duration)
        recordView?.durationLabel.text = String(duration)

        // 超时自动发送
        //: if interval>RecordMaxDuration {
        if interval > RecordMaxDuration {
            //: let path =  stopRecord()
            let path = listNowRecord()
            //: recordView?.setRecordStatus(status: .tooLong)
            recordView?.count(status: .tooLong)

            //: DispatchQueue.main.asyncAfter(deadline: .now()+1.0, execute: {
            DispatchQueue.main.asyncAfter(deadline: .now() + 1.0) {
                //: self.recordView?.hidenView()
                self.recordView?.viewMove()
                //: })
            }
            //: if path.isEmpty == false {
            if path.isEmpty == false {
                //: self.delegate? .func__sendVoiceMsg(voicePath: path, voiceTime: 30)
                self.delegate?.pan(voicePath: path, voiceTime: 30)
            }
        }
    }

    //: func stopRecord()->String {
    func listNowRecord() -> String {
        //: if recordTimer != nil {
        if recordTimer != nil {
            //: recordTimer?.invalidate()
            recordTimer?.invalidate()
            //: recordTimer = nil
            recordTimer = nil
        }
        //: if recorder?.isRecording != false {
        if recorder?.isRecording != false {
            //: recorder?.stop()
            recorder?.stop()
        }
        //: return recorder?.url.path ?? ""
        return recorder?.url.path ?? ""
    }

    //: func getVoiceRecordLocalPathWithFileType(path: NSString) -> String {
    func pathEqual(path: NSString) -> String {
        //: if !FileManager.default.fileExists(atPath: Talking_Chat_record_SandboxPath) {
        if !FileManager.default.fileExists(atPath: kLet_appDisplayScreenData) {
            //: do {
            do {
                //: try FileManager.default.createDirectory(atPath: Talking_Chat_record_SandboxPath, withIntermediateDirectories: true, attributes: nil)
                try FileManager.default.createDirectory(atPath: kLet_appDisplayScreenData, withIntermediateDirectories: true, attributes: nil)
                //: }catch {
            } catch {}
        }

        //: let timestr = NSDate.timeIntervalSinceReferenceDate
        let timestr = NSDate.timeIntervalSinceReferenceDate
        //: let uid = RecordAppManager.share.loginUserMode.userID
        let uid = RecordAppManager.share.loginUserMode.userID
        //: if uid.count == 0 { return "" }
        if uid.count == 0 { return "" }

        //: return Talking_Chat_record_SandboxPath + "_" + uid + "_" + String(Int(timestr)) + "." + (path as String)
        return kLet_appDisplayScreenData + "_" + uid + "_" + String(Int(timestr)) + "." + (path as String)
    }

    //: func cancelRecord(isTooLong: Bool) {
    func enableFree(isTooLong: Bool) {
        //: if recordTimer != nil {
        if recordTimer != nil {
            //: recordTimer?.invalidate()
            recordTimer?.invalidate()
            //: recordTimer = nil
            recordTimer = nil
        }
        //: if recorder?.isRecording != false {
        if recorder?.isRecording != false {
            //: recorder?.stop()
            recorder?.stop()
        }

        //: if isTooLong {
        if isTooLong {
            //: return
            return
        }
        //: let path = recorder?.url.path
        let path = recorder?.url.path
        //: if FileManager.default.fileExists(atPath: path!) {
        if FileManager.default.fileExists(atPath: path!) {
            //: do {
            do {
                //: try FileManager.default.removeItem(atPath: path!)
                try FileManager.default.removeItem(atPath: path!)
                //: }catch {
            } catch {}
        }
    }
}
