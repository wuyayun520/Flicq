
//: Declare String Begin

/*: / :*/
fileprivate let str_timeData:String = "/"

/*:  ( :*/
fileprivate let str_effectData:String = " request"

/*: ; build: :*/
fileprivate let str_flowData:String = "view attention row let make; build"
fileprivate let str_backName:String = ":"

/*: ; iOS  :*/
fileprivate let str_conText:String = "message add feedback user; iOS "

/*: ;  :*/
fileprivate let str_popTitle:String = "index "

/*: )" :*/
fileprivate let str_makeValue:[Character] = [")"]

/*: "audio" :*/
fileprivate let str_meetingValue:String = "aubeforeo"

/*: + :*/
fileprivate let str_colorManagerData:String = "on"

/*: .wav" :*/
fileprivate let str_examineTitle:String = ".wavicon path super date return"

/*: "audio/wav" :*/
fileprivate let str_dataObjectText:String = "audicomment"

/*: .jpg" :*/
fileprivate let str_voiceEqualName:[Character] = [".","j","p","g"]

/*: "image/jpeg" :*/
fileprivate let str_allRequestValue:String = "roommag"

/*: "://app." :*/
fileprivate let str_blockBirthTitle:[Character] = [":","/","/","a","p","p","."]

/*: "\"data\":null" :*/
fileprivate let str_hiddenValue:String = "\"data"
fileprivate let str_micValue:String = "\":null"

/*: "\"data\":{}" :*/
fileprivate let str_shareValue:String = "\"data\":{}"

/*: ":null" :*/
fileprivate let str_tableWillContent:String = ":nullrequest a info region"

/*: ":\"\"" :*/
fileprivate let str_actionData:String = ":\"\\"

/*: "Request failed, Try again later" :*/
fileprivate let str_sectionTitle:[UInt8] = [0x73,0x86,0x92,0x96,0x86,0x94,0x95,0x41,0x87,0x82,0x8a,0x8d,0x86,0x85,0x4d,0x41,0x75,0x93,0x9a,0x41,0x82,0x88,0x82,0x8a,0x8f,0x41,0x8d,0x82,0x95,0x86,0x93]

fileprivate func viewFind(party num: UInt8) -> UInt8 {
    let value = Int(num) - 33
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "json error" :*/
fileprivate let str_mentionErrorTitle:String = "json errleading extension"
fileprivate let str_writeValue:String = "touchr"

/*: "platform=iphone&version= :*/
fileprivate let str_effectValue:String = "maximumat"
fileprivate let str_biologyUsData:String = "matchhone"
fileprivate let str_coinText:[Character] = ["="]

/*: &packageId= :*/
fileprivate let str_scaleContent:[Character] = ["&","p","a","c","k","a","g","e","I","d","="]

/*: &bundleId= :*/
fileprivate let str_picName:[Character] = ["&","b"]
fileprivate let str_roomText:String = "norndl"

/*: &lang= :*/
fileprivate let str_interactionData:[Character] = ["&","l","a","n","g","="]

/*: "?!@#$^&%*+,:;='\"`<>()[]{}/\\| " :*/
fileprivate let str_paraName:[Character] = ["?","!","@","#","$","^","&","%","*","+",",",":",";","=","\'","\"","`","<",">","(",")","[","]","{"]
fileprivate let str_libraryWithText:[Character] = ["}","/","\\","|"," "]

/*: "/route/slowindex" :*/
fileprivate let str_dismissData:[Character] = ["/"]
fileprivate let str_rowValue:String = "self main byroute/"
fileprivate let str_imagePositionValue:String = "iinfoex"

/*: "/route/index" :*/
fileprivate let str_regularLinkName:String = "/routecolor return make collection"
fileprivate let str_timeUserTitle:String = "instance else let title/index"

/*: "?path= :*/
fileprivate let str_homeValue:String = "?path=mode view for cell event"

/*: "&GJNonceStr= :*/
fileprivate let str_observeData:[Character] = ["&","G","J","N","o","n"]
fileprivate let str_sendImageRecordName:[Character] = ["c","e","S","t","r","="]

/*: "& :*/
fileprivate let str_touchValue:[Character] = ["&"]

/*: = :*/
fileprivate let str_locationName:String = "="

/*: "&params= :*/
fileprivate let str_managerText:String = "talk"
fileprivate let str_resultEmptyData:String = "list taskparams="

/*: "/ :*/
fileprivate let str_managerToData:[Character] = ["/"]

/*: "? :*/
fileprivate let str_imageInfoVoiceContent:String = "list"

/*: "token" :*/
fileprivate let str_liveText:String = "tokeview"

/*: "请求成功 :*/
fileprivate let str_laboratoryName:[Character] = ["请","\u{6c42}","成","\u{529f}"]

/*: "AAAAAAAA" :*/
fileprivate let str_actualTitle:String = "to"
fileprivate let str_viewUserText:String = "coincoincoincoincoincoincoin"

/*: "AA" :*/
fileprivate let str_birthGestureName:[Character] = ["A","A"]

/*: "BB" :*/
fileprivate let str_whiteUpName:String = "app"

/*: "下载完成 -  :*/
fileprivate let str_labelViewData:String = "下载完\u{6210} - "

/*: "/Documents/" :*/
fileprivate let str_playerName:String = "/Dlet let with"
fileprivate let str_flexibleValue:[Character] = ["o","c","u","m","e","n","t","s","/"]

/*: ".mp4" :*/
fileprivate let str_attachName:[Character] = [".","m","p","4"]

/*: "移动地址: :*/
fileprivate let str_managerContent:String = "移动\u{5730}址:"

/*: "后台任务下载回来" :*/
fileprivate let str_matchText:[Character] = ["后","\u{53f0}","\u{4efb}","\u{52a1}","\u{4e0b}"]
fileprivate let str_whiteMakeValue:String = "载user来"

/*: "下载成功 : :*/
fileprivate let str_bindData:[Character] = ["下","载","成","功"," "]
fileprivate let str_countEqualData:String = "make"

/*: "Net Error" :*/
fileprivate let str_managerTitle:[Character] = ["N","e","t"," ","E","r"]
fileprivate let str_showTimeData:String = "infor"

/*: "下载失败 : :*/
fileprivate let str_makeContent:[Character] = ["下","\u{8f7d}","失","\u{8d25}"," ",":"]

//: Declare String End

// __DEBUG__
// __CLOSE_PRINT__
//
//  VersionReactiveCompatible.swift
//  AbroadTalking
//
//  Created by Hemming on 2022/1/28.
//

//: import UIKit
import UIKit

//: import Alamofire
import Alamofire

//: import CoreMedia
import CoreMedia

// 默认请求超时时间
//: let REQUEST_TIMEOUT_INTERVAL = 10.0
let kLet_informationName = 10.0

//: let userAgent = "\(AppName)/\(AppVersion) (\(AppBundle); build:\(AppBuildNumber); iOS \(UIDevice.current.systemVersion); \(UIDevice.modelName))"
let kLet_buttonWithoutName = "\(kLet_limitEnterData)/\(kLet_closeTitle) (\(kLet_tabFreeViewValue)" + (String(str_flowData.suffix(7)) + str_backName.capitalized) + "\(kLet_streamData)" + (String(str_conText.suffix(6))) + "\(UIDevice.current.systemVersion); \(UIDevice.modelName))"

//: typealias FinishBlock = (_ succeed: Bool, _ result: Any?, _ errorModel: TalkingErrorResponse?) -> Void
typealias FinishBlock = (_ succeed: Bool, _ result: Any?, _ errorModel: ItemErrorResponse?) -> Void

//: let GJ = TalkingRequestTool.init()
let kLet_reasonText = VersionReactiveCompatible()

//: @objc class TalkingRequestTool: NSObject, URLSessionDownloadDelegate {
@objc class VersionReactiveCompatible: NSObject, URLSessionDownloadDelegate {
    //: public func startRequest(model: TalkingRequestModel, completion: @escaping FinishBlock) {
    public func priceSub(model: PtolemaicSystemThen, completion: @escaping FinishBlock) {
        //: if model.paramsContainBinaryObject() {
        if model.qualify() {
            //: self.startUploadDataRequest(model: model, completion: completion)
            self.dataCompletion(model: model, completion: completion)
            //: } else {
        } else {
            //: self.startNormalRequest(model: model, completion: completion)
            self.blockState(model: model, completion: completion)
        }
    }

    //: public func startUploadDataRequest(model: TalkingRequestModel, completion: @escaping FinishBlock) {
    public func dataCompletion(model: PtolemaicSystemThen, completion: @escaping FinishBlock) {
        //: let serverUrl = self.buildServerUrl(model: model)
        let serverUrl = self.equalSession(model: model)
        //: let headers = self.getRequestHeader(model: model)
        let headers = self.getHoldSelect(model: model)

        //: if model.requestType == .GET {
        if model.requestType == .GET {
            //: AF.request(serverUrl, method: .get, parameters: model.params, headers: headers).responseData { [self] responseData in
            AF.request(serverUrl, method: .get, parameters: model.params, headers: headers).responseData { [self] responseData in
                //: switch responseData.result {
                switch responseData.result {
                //: case .success:
                case .success:
                    //: func__requestSucess(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                    collectionPrice(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                //: break
                //: case .failure:
                case .failure:
                    //: completion(false, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.NetError.rawValue, errorMsg: kNetErrorMsg))
                    completion(false, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.NetError.rawValue, errorMsg: kLet_homeText))
                    //: if model.showErrorStatusBar {
                    if model.showErrorStatusBar {
                        //: func__showStatusBarErrorMsg(showMsg: kNetErrorMsg)
                        talkTask(showMsg: kLet_homeText)
                    }

                    //: break
                }
            }
            //: } else {
        } else {
            //: AF.upload(multipartFormData: { (multipartFormData) in
            AF.upload(multipartFormData: { multipartFormData in
                //: for (key, value) in model.params {
                for (key, value) in model.params {
                    //: if value is Data {
                    if value is Data {
                        //: if key == "audio" {
                        if key == (str_meetingValue.replacingOccurrences(of: "before", with: "di")) {
                            //: multipartFormData.append(value as! Data, withName: key, fileName: "\(NSDate.getCurrentTimeStamp())+\(PackageID).wav", mimeType: "audio/wav")
                            multipartFormData.append(value as! Data, withName: key, fileName: "\(NSDate.notWith())+\(kLet_closedData)" + (String(str_examineTitle.prefix(4))), mimeType: (str_dataObjectText.replacingOccurrences(of: "comment", with: "o") + "/wav"))
                            //: } else {
                        } else {
                            //: multipartFormData.append(value as! Data, withName: key, fileName: "\(key).jpg", mimeType: "image/jpeg")
                            multipartFormData.append(value as! Data, withName: key, fileName: "\(key)" + (String(str_voiceEqualName)), mimeType: (str_allRequestValue.replacingOccurrences(of: "room", with: "i") + "e/jpeg"))
                        }
                        //: } else {
                    } else {
                        //: let data_ = "\(value)".data(using: String.Encoding.utf8)!
                        let data_ = "\(value)".data(using: String.Encoding.utf8)!
                        //: multipartFormData.append(data_, withName: key)
                        multipartFormData.append(data_, withName: key)
                    }
                }
                //: }, to: serverUrl, method: .post, headers: headers).responseData { [self] responseData in
            }, to: serverUrl, method: .post, headers: headers).responseData { [self] responseData in
                //: switch responseData.result {
                switch responseData.result {
                //: case .success:
                case .success:
                    //: func__requestSucess(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                    collectionPrice(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                //: break
                //: case .failure:
                case .failure:
                    //: completion(false, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.NetError.rawValue, errorMsg: kNetErrorMsg))
                    completion(false, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.NetError.rawValue, errorMsg: kLet_homeText))
                    //: if model.showErrorStatusBar {
                    if model.showErrorStatusBar {
                        //: func__showStatusBarErrorMsg(showMsg: kNetErrorMsg)
                        talkTask(showMsg: kLet_homeText)
                    }

                    //: break
                }
            }
        }
    }

    //: public func startNormalRequest(model: TalkingRequestModel, completion: @escaping FinishBlock) {
    public func blockState(model: PtolemaicSystemThen, completion: @escaping FinishBlock) {
        //: let serverUrl = self.buildServerUrl(model: model)
        let serverUrl = self.equalSession(model: model)
        //: let headers = self.getRequestHeader(model: model)
        let headers = self.getHoldSelect(model: model)

        //: if model.requestType == .GET {
        if model.requestType == .GET {
            //: AF.request(serverUrl, method: .get, parameters: (Encryption_Request ? nil : model.params), headers: headers, requestModifier: { $0.timeoutInterval = REQUEST_TIMEOUT_INTERVAL }).responseData { [self] responseData in
            AF.request(serverUrl, method: .get, parameters: kLet_succeedSuccessName ? nil : model.params, headers: headers, requestModifier: { $0.timeoutInterval = kLet_informationName }).responseData { [self] responseData in
                //: switch responseData.result {
                switch responseData.result {
                //: case .success:
                case .success:
                    //: func__requestSucess(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                    collectionPrice(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                //: break
                //: case .failure:
                case .failure:
                    //: completion(false, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.NetError.rawValue, errorMsg: kNetErrorMsg))
                    completion(false, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.NetError.rawValue, errorMsg: kLet_homeText))
                    //: if model.showErrorStatusBar {
                    if model.showErrorStatusBar {
                        //: func__showStatusBarErrorMsg(showMsg: kNetErrorMsg)
                        talkTask(showMsg: kLet_homeText)
                    }
                    //: break
                }
            }
            //: } else {
        } else {
            //: AF.request(serverUrl, method: .post, parameters: model.params, headers: headers, requestModifier: { $0.timeoutInterval = REQUEST_TIMEOUT_INTERVAL }).responseData { [self] responseData in
            AF.request(serverUrl, method: .post, parameters: model.params, headers: headers, requestModifier: { $0.timeoutInterval = kLet_informationName }).responseData { [self] responseData in
                //: switch responseData.result {
                switch responseData.result {
                //: case .success:
                case .success:
                    //: func__requestSucess(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                    collectionPrice(model: model, response: responseData.response!, responseData: responseData.data!, completion: completion)
                //: break
                //: case .failure:
                case .failure:
                    //: completion(false, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.NetError.rawValue, errorMsg: kNetErrorMsg))
                    completion(false, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.NetError.rawValue, errorMsg: kLet_homeText))
                    //: if model.showErrorStatusBar {
                    if model.showErrorStatusBar {
                        //: func__showStatusBarErrorMsg(showMsg: kNetErrorMsg)
                        talkTask(showMsg: kLet_homeText)
                    }

                    //: break
                }
            }
        }
    }

    //: func func__requestSucess(model: TalkingRequestModel, response: HTTPURLResponse, responseData: Data, completion: @escaping FinishBlock) {
    func collectionPrice(model: PtolemaicSystemThen, response: HTTPURLResponse, responseData: Data, completion: @escaping FinishBlock) {
        //: let httpCookies = HTTPCookie.cookies(withResponseHeaderFields: response.allHeaderFields as! [String: String], for: response.url!)
        let httpCookies = HTTPCookie.cookies(withResponseHeaderFields: response.allHeaderFields as! [String: String], for: response.url!)
        //: if httpCookies.count > 0 {
        if httpCookies.count > 0 {
            //: TalkingRequestAddrTool.share.func__updateTalkingCookies(cookies: httpCookies)
            DemandReactiveCompatible.share.nameModifyCookiesFuncTalking(cookies: httpCookies)
        }

        //: var responseJson = String(data: responseData, encoding: .utf8)
        var responseJson = String(data: responseData, encoding: .utf8)

        //: if Encryption_Request, model.requestServer.contains("://app.") {
        if kLet_succeedSuccessName, model.requestServer.contains((String(str_blockBirthTitle))) {
            //: responseJson = responseJson?.aes256Decrypt(key: TalkingRequestAddrTool.share.encryKeyStr)
            responseJson = responseJson?.aes256Decrypt(key: DemandReactiveCompatible.share.encryKeyStr)
        }

        //: responseJson = responseJson?.replacingOccurrences(of: "\"data\":null", with: "\"data\":{}")
        responseJson = responseJson?.replacingOccurrences(of: (str_hiddenValue + str_micValue), with: (str_shareValue))
        //: if !Encryption_Request {
        if !kLet_succeedSuccessName {
            //: responseJson = responseJson?.replacingOccurrences(of: ":null", with: ":\"\"")
            responseJson = responseJson?.replacingOccurrences(of: (String(str_tableWillContent.prefix(5))), with: ":\"\"")
        }
        //: if let responseModel = JSONDeserializer<TalkingBaseResponse>.deserializeFrom(json: responseJson) {
        if let responseModel = JSONDeserializer<MaleTransformable>.deserializeFrom(json: responseJson) {
            //: if responseModel.errno == RequestResultCode.Normal.rawValue {
            if responseModel.errno == ManagerValueConvertible.Normal.rawValue {
                //: completion(true, responseModel.data, nil)
                completion(true, responseModel.data, nil)
                //: } else {
            } else {
                //: completion(false, responseModel.data, TalkingErrorResponse.init(errorCode: responseModel.errno, errorMsg: responseModel.msg ?? ""))
                completion(false, responseModel.data, ItemErrorResponse(errorCode: responseModel.errno, errorMsg: responseModel.msg ?? ""))
                //: if model.showErrorStatusBar {
                if model.showErrorStatusBar {
                    //: func__showStatusBarErrorMsg(showMsg: responseModel.msg ?? "Request failed, Try again later".localized)
                    talkTask(showMsg: responseModel.msg ?? String(bytes: str_sectionTitle.map{viewFind(party: $0)}, encoding: .utf8)!.localized)
                }
                //: switch responseModel.errno {
                switch responseModel.errno {
                //: case RequestResultCode.NeedReLogin.rawValue:
                case ManagerValueConvertible.NeedReLogin.rawValue:
                    //: NotificationCenter.default.post(name: DID_LOGIN_OUT_SUCCESS_NOTIFICATION, object: nil, userInfo: nil)
                    NotificationCenter.default.post(name: kLet_domainChangeMessageValue, object: nil, userInfo: nil)
                //: default:
                default:
                    //: break
                    break
                }
            }
            //: } else {
        } else {
            //: completion(false, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.NetError.rawValue, errorMsg: "json error".localized))
            completion(false, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.NetError.rawValue, errorMsg: (String(str_mentionErrorTitle.prefix(8)) + str_writeValue.replacingOccurrences(of: "touch", with: "o")).localized))
        }
    }

    //: func buildServerUrl(model: TalkingRequestModel) -> String {
    func equalSession(model: PtolemaicSystemThen) -> String {
        //: var serverUrl: String = model.requestServer
        var serverUrl: String = model.requestServer

        //: var otherParams = "platform=iphone&version=\(AppNetVersion)&packageId=\(PackageID)&bundleId=\(AppBundle)&lang=\(TalkingRequestAddrTool.share.interfaceLang)"
        var otherParams = (str_effectValue.replacingOccurrences(of: "maximum", with: "pl") + "form=i" + str_biologyUsData.replacingOccurrences(of: "match", with: "p") + "&version" + String(str_coinText)) + "\(kLet_userNoText)" + (String(str_scaleContent)) + "\(kLet_closedData)" + (String(str_picName) + str_roomText.replacingOccurrences(of: "nor", with: "u") + "eId=") + "\(kLet_tabFreeViewValue)" + (String(str_interactionData)) + "\(DemandReactiveCompatible.share.interfaceLang)"
        //: if Encryption_Request, serverUrl.contains("://app.") {
        if kLet_succeedSuccessName, serverUrl.contains((String(str_blockBirthTitle))) {
            //: let allowCharSet: CharacterSet = CharacterSet.init(charactersIn: "?!@#$^&%*+,:;='\"`<>()[]{}/\\| ").inverted
            let allowCharSet = CharacterSet(charactersIn: "?!@#$^&%*+,:;='\"`<>()[]{}/\\| ").inverted
            //: if TalkingRequestAddrTool.share.slowPathArr.contains(model.requestPath) {
            if DemandReactiveCompatible.share.slowPathArr.contains(model.requestPath) {
                //: serverUrl.append("/route/slowindex")
                serverUrl.append((String(str_dismissData) + String(str_rowValue.suffix(6)) + "slow" + str_imagePositionValue.replacingOccurrences(of: "info", with: "nd")))
                //: } else {
            } else {
                //: serverUrl.append("/route/index") // 如果使用IP需要加上app/
                serverUrl.append((String(str_regularLinkName.prefix(6)) + String(str_timeUserTitle.suffix(6)))) // 如果使用IP需要加上app/
            }

            //: let pathStr = model.requestPath.addingPercentEncoding(withAllowedCharacters: allowCharSet)!
            let pathStr = model.requestPath.addingPercentEncoding(withAllowedCharacters: allowCharSet)!
            //: serverUrl.append("?path=\(pathStr)")
            serverUrl.append((String(str_homeValue.prefix(6))) + "\(pathStr)")
            //: serverUrl.append("&GJNonceStr=\(TalkingRequestAddrTool.share.randomStr)")
            serverUrl.append((String(str_observeData) + String(str_sendImageRecordName)) + "\(DemandReactiveCompatible.share.randomStr)")

            //: if model.requestType == .GET {
            if model.requestType == .GET {
                //: for (key, value) in model.params {
                for (key, value) in model.params {
                    //: otherParams.append("&\(key)=\(value)")
                    otherParams.append("&\(key)=\(value)")
                }
            }
            //: if let encryStr = otherParams.aes256Encrypt(key: TalkingRequestAddrTool.share.encryKeyStr) {
            if let encryStr = otherParams.aes256Encrypt(key: DemandReactiveCompatible.share.encryKeyStr) {
                //: let paramsStr = encryStr.addingPercentEncoding(withAllowedCharacters: allowCharSet)!
                let paramsStr = encryStr.addingPercentEncoding(withAllowedCharacters: allowCharSet)!
                //: serverUrl.append("&params=\(paramsStr)")
                serverUrl.append((str_managerText.replacingOccurrences(of: "talk", with: "&") + String(str_resultEmptyData.suffix(7))) + "\(paramsStr)")
            }
            //: printLog(message: serverUrl)
            printLog(message: serverUrl)
            //: } else {
        } else {
            //: if !model.requestPath.isEmptyString {
            if !model.requestPath.isEmptyString {
                //: serverUrl.append("/\(model.requestPath)")
                serverUrl.append("/\(model.requestPath)")
            }
            //: serverUrl.append("?\(otherParams)")
            serverUrl.append("?\(otherParams)")
        }
        //: return serverUrl
        return serverUrl
    }

    /// 获取请求头参数
    /// - Parameter model: 请求模型
    /// - Returns: 请求头参数
    //: func getRequestHeader(model: TalkingRequestModel) -> HTTPHeaders {
    func getHoldSelect(model: PtolemaicSystemThen) -> HTTPHeaders {
        //: var headers = [HTTPHeader.userAgent(userAgent)]
        var headers = [HTTPHeader.userAgent(kLet_buttonWithoutName)]
        //: if model.addHeaderToken.isEmpty == false {
        if model.addHeaderToken.isEmpty == false {
            //: let token = HTTPHeader(name: "token", value: model.addHeaderToken)
            let token = HTTPHeader(name: (str_liveText.replacingOccurrences(of: "view", with: "n")), value: model.addHeaderToken)
            //: headers.append(token)
            headers.append(token)
        }
        //: return HTTPHeaders(headers)
        return HTTPHeaders(headers)
    }

    // MARK: - 系统后台下载

    //: func urlSessionBackgroundDownLoad(model: TalkingRequestModel) {
    func addDetail(model: PtolemaicSystemThen) {
        //: let serverUrl = self.buildServerUrl(model: model)
        let serverUrl = self.equalSession(model: model)
        //: URLSession.shared.dataTask(with: URL.init(string: serverUrl)!) {(data, response, error) in
        URLSession.shared.dataTask(with: URL(string: serverUrl)!) { _, response, error in
            //: if error == nil {
            if error == nil {
                //: printLog(message: "请求成功\(String(describing: response))" )
                printLog(message: (String(str_laboratoryName)) + "\(String(describing: response))")
            }
        }

//        let configuration1 = URLSessionConfiguration.default    // default模式下系统会创建一个持久化的缓存并在用户的钥匙串中存储证书
//        let configuration2 = URLSessionConfiguration.ephemeral  // 所有内容的生命周期都与session相同，当session无效时，所有内容自动释放。

        // 后台下载
        //: let configuration3 = URLSessionConfiguration.background(withIdentifier: "AAAAAAAA")  // 后台甚至APP已经关闭的时候仍然在传输数据的会话
        let configuration3 = URLSessionConfiguration.background(withIdentifier: (str_actualTitle.replacingOccurrences(of: "to", with: "A") + str_viewUserText.replacingOccurrences(of: "coin", with: "A"))) // 后台甚至APP已经关闭的时候仍然在传输数据的会话
        //: configuration3.httpAdditionalHeaders = ["AA": "AA", "BB": "BB"] // 与请求一起发送的附加头文件的字典
        configuration3.httpAdditionalHeaders = ["AA": "AA", "BB": "BB"] // 与请求一起发送的附加头文件的字典
        //: configuration3.networkServiceType = .default
        configuration3.networkServiceType = .default // 网络服务的类型
        //: configuration3.allowsCellularAccess = true
        configuration3.allowsCellularAccess = true // 一个布尔值，用于确定是否应通过蜂窝网络进行连接
        //: configuration3.timeoutIntervalForRequest = 15
        configuration3.timeoutIntervalForRequest = 15
        //: configuration3.timeoutIntervalForResource = 15
        configuration3.timeoutIntervalForResource = 15
        //: let session = URLSession.init(configuration: configuration3, delegate: self, delegateQueue: OperationQueue.main)
        let session = URLSession(configuration: configuration3, delegate: self, delegateQueue: OperationQueue.main)
        //: session.downloadTask(with: URL.init(string: serverUrl)!).resume()
        session.downloadTask(with: URL(string: serverUrl)!).resume()
    }

    //: func urlSession(_ session: URLSession, downloadTask: URLSessionDownloadTask, didFinishDownloadingTo location: URL) {
    func urlSession(_: URLSession, downloadTask _: URLSessionDownloadTask, didFinishDownloadingTo location: URL) {
        //: printLog(message: "下载完成 - \(location)")
        printLog(message: (str_labelViewData) + "\(location)")
        //: let locationPath = location.path
        let locationPath = location.path
        //: let documnets = NSHomeDirectory() + "/Documents/" + NSDate.getCurrentTimeStamp() + ".mp4"
        let documnets = NSHomeDirectory() + (String(str_playerName.prefix(2)) + String(str_flexibleValue)) + NSDate.notWith() + (String(str_attachName))
        //: printLog(message: "移动地址:\(documnets)")
        printLog(message: (str_managerContent) + "\(documnets)")
        //: let fileManager = FileManager.default
        let fileManager = FileManager.default
        //: do {
        do {
            //: try fileManager.moveItem(atPath: locationPath, toPath: documnets)
            try fileManager.moveItem(atPath: locationPath, toPath: documnets)
            //: } catch {
        } catch {
            // catch 中默认提供error信息, 当序列化不成功是, 返回error
            //: printLog(message: error)
            printLog(message: error)
        }
    }

    // 监听下载进度
    //: func urlSession(_ session: URLSession, downloadTask: URLSessionDownloadTask, didWriteData bytesWritten: Int64, totalBytesWritten: Int64, totalBytesExpectedToWrite: Int64) {
    func urlSession(_: URLSession, downloadTask _: URLSessionDownloadTask, didWriteData _: Int64, totalBytesWritten _: Int64, totalBytesExpectedToWrite _: Int64) {}

    //: func urlSessionDidFinishEvents(forBackgroundURLSession session: URLSession) {
    func urlSessionDidFinishEvents(forBackgroundURLSession _: URLSession) {
        //: printLog(message: "后台任务下载回来")
        printLog(message: (String(str_matchText) + str_whiteMakeValue.replacingOccurrences(of: "user", with: "回")))
        //: DispatchQueue.main.async {
        DispatchQueue.main.async {
            //: guard let backgroundHandle = AppDelegateHelper.shared.backgroundSessionCompletionHandler else { return }
            guard let backgroundHandle = ColorDelegateHelper.shared.backgroundSessionCompletionHandler else { return }
            //: backgroundHandle()
            backgroundHandle()
        }
    }

    // MARK: - 动画下载

    //: public func startGiftZipRequest(giftUrl: String, path: String, completion: @escaping FinishBlock) {
    public func loadPresent(giftUrl: String, path: String, completion: @escaping FinishBlock) {
        //: let destination: DownloadRequest.Destination = { _, _ in
        let destination: DownloadRequest.Destination = { _, _ in
            //: let pathUrl = URL(fileURLWithPath: path)
            let pathUrl = URL(fileURLWithPath: path)
            //: return (pathUrl, [.removePreviousFile, .createIntermediateDirectories])
            return (pathUrl, [.removePreviousFile, .createIntermediateDirectories])
        }
        //: let giftUrlStr = giftUrl.replacingOccurrences(of: UrlDomin.urlAes256Decrypt(), with: ReplaceUrlDomain)
        let giftUrlStr = giftUrl.replacingOccurrences(of: UrlDomin.urlAes256Decrypt(), with: kLet_keyViewName)
        //: AF.download(giftUrlStr, to: destination).downloadProgress { speed in
        AF.download(giftUrlStr, to: destination).downloadProgress { _ in
        }
        //: .responseData { response in
        .responseData { response in
            //: switch response.result {
            switch response.result {
            //: case .success(let json):
            case let .success(json):
                //: printLog(message: "下载成功 :\(json)")
                printLog(message: (String(str_bindData) + str_countEqualData.replacingOccurrences(of: "make", with: ":")) + "\(json)")
                //: completion(true, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.Normal.rawValue, errorMsg: "Net Error".localized))
                completion(true, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.Normal.rawValue, errorMsg: (String(str_managerTitle) + str_showTimeData.replacingOccurrences(of: "info", with: "ro")).localized))
            //: break
            //: case .failure(let errMsg):
            case let .failure(errMsg):
                //: completion(false, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.NetError.rawValue, errorMsg: "Net Error".localized))
                completion(false, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.NetError.rawValue, errorMsg: (String(str_managerTitle) + str_showTimeData.replacingOccurrences(of: "info", with: "ro")).localized))

                //: printLog(message: "下载失败 :\(errMsg)")
                printLog(message: (String(str_makeContent)) + "\(errMsg)")
            }
        }
    }

    //: public func startVoiceRequest(voiceUrl: String, path: String, completion: @escaping FinishBlock) {
    public func recover(voiceUrl: String, path: String, completion: @escaping FinishBlock) {
        //: let destination: DownloadRequest.Destination = { _, _ in
        let destination: DownloadRequest.Destination = { _, _ in
            //: let pathUrl = URL(fileURLWithPath: path)
            let pathUrl = URL(fileURLWithPath: path)
            //: return (pathUrl, [.removePreviousFile, .createIntermediateDirectories])
            return (pathUrl, [.removePreviousFile, .createIntermediateDirectories])
        }

        //: let voiceUrlStr = voiceUrl.replacingOccurrences(of: UrlDomin.urlAes256Decrypt(), with: ReplaceUrlDomain)
        let voiceUrlStr = voiceUrl.replacingOccurrences(of: UrlDomin.urlAes256Decrypt(), with: kLet_keyViewName)
        //: AF.download(voiceUrlStr, to: destination).downloadProgress { speed in
        AF.download(voiceUrlStr, to: destination).downloadProgress { _ in
        }
        //: .responseData { response in
        .responseData { response in
            //: switch response.result {
            switch response.result {
            //: case .success(let json):
            case let .success(json):
                //: printLog(message: "下载成功 :\(json)")
                printLog(message: (String(str_bindData) + str_countEqualData.replacingOccurrences(of: "make", with: ":")) + "\(json)")
                //: completion(true, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.Normal.rawValue, errorMsg: "Net Error".localized))
                completion(true, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.Normal.rawValue, errorMsg: (String(str_managerTitle) + str_showTimeData.replacingOccurrences(of: "info", with: "ro")).localized))
            //: break
            //: case .failure(let errMsg):
            case let .failure(errMsg):
                //: completion(false, nil, TalkingErrorResponse.init(errorCode: RequestResultCode.NetError.rawValue, errorMsg: "Net Error".localized))
                completion(false, nil, ItemErrorResponse(errorCode: ManagerValueConvertible.NetError.rawValue, errorMsg: (String(str_managerTitle) + str_showTimeData.replacingOccurrences(of: "info", with: "ro")).localized))

                //: printLog(message: "下载失败 :\(errMsg)")
                printLog(message: (String(str_makeContent)) + "\(errMsg)")
            }
        }
    }
}
