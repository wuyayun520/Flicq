
//: Declare String Begin

/*: "init(coder:) has not been implemented" :*/
fileprivate let str_modeSizeName:[UInt8] = [0xa1,0xa6,0xa1,0xbc,0xe0,0xab,0xa7,0xac,0xad,0xba,0xf2,0xe1,0xe8,0xa0,0xa9,0xbb,0xe8,0xa6,0xa7,0xbc,0xe8,0xaa,0xad,0xad,0xa6,0xe8,0xa1,0xa5,0xb8,0xa4,0xad,0xa5,0xad,0xa6,0xbc,0xad,0xac]

/*: "Load..." :*/
fileprivate let str_cancelValue:[Character] = ["L"]
fileprivate let str_makeData:String = "oad...for case model"

/*: "Skip" :*/
fileprivate let str_videoAddData:[Character] = ["S","k","i","p"]

/*: "HttpTool.NativeToJs('recharge')" :*/
fileprivate let str_makeValue:[UInt8] = [0x6f,0x53,0x53,0x57,0x73,0x48,0x48,0x4b,0x9,0x69,0x46,0x53,0x4e,0x51,0x42,0x73,0x48,0x6d,0x54,0xf,0x0,0x55,0x42,0x44,0x4f,0x46,0x55,0x40,0x42,0x0,0xe]

private func genderQuery(biology num: UInt8) -> UInt8 {
    return num ^ 39
}

/*: "window.onPageShow&&onPageShow();" :*/
fileprivate let str_succeedData:[UInt8] = [0x3b,0x29,0x28,0x77,0x6f,0x68,0x53,0x65,0x67,0x61,0x50,0x6e,0x6f,0x26,0x26,0x77,0x6f,0x68,0x53,0x65,0x67,0x61,0x50,0x6e,0x6f,0x2e,0x77,0x6f,0x64,0x6e,0x69,0x77]

/*: "jsEvent(onPageShow):  :*/
fileprivate let str_directionText:[Character] = ["j","s","E","v","e","n","t","(","o","n"]
fileprivate let str_quoteData:[Character] = ["P","a","g","e"]
fileprivate let str_viewImageTitle:String = "Show): image path mini self info"

/*: --- :*/
fileprivate let str_donName:[Character] = ["-","-","-"]

/*: "window.onPageHide&&onPageHide();" :*/
fileprivate let str_hiddenData:[UInt8] = [0x2f,0x31,0x36,0x3c,0x37,0x2f,0x76,0x37,0x36,0x8,0x39,0x3f,0x3d,0x10,0x31,0x3c,0x3d,0x7e,0x7e,0x37,0x36,0x8,0x39,0x3f,0x3d,0x10,0x31,0x3c,0x3d,0x70,0x71,0x63]

private func gestureAt(main num: UInt8) -> UInt8 {
    return num ^ 88
}

/*: "jsEvent(onPageHide):  :*/
fileprivate let str_labelText:[Character] = ["j","s","E","v","e","n","t","(","o","n","P","a"]
fileprivate let str_serverSucceedTitle:[Character] = ["g"]
fileprivate let str_burnName:String = "eHide): action else to self"

/*: "title" :*/
fileprivate let str_leadingTitle:[Character] = ["t","i","t","l","e"]

/*: "canGoBack" :*/
fileprivate let str_tagUserValue:String = "canGoBacsource equal background"
fileprivate let str_clearSourceTitle:[Character] = ["k"]

/*: "PHPSESSID= :*/
fileprivate let str_pairSizeTitle:String = "PHPcell"

/*: ";uid= :*/
fileprivate let str_requestValue:[Character] = [";","u","i","d","="]

/*: "Cookie" :*/
fileprivate let str_reasonData:[Character] = ["C","o","o","k","i"]
fileprivate let str_voiceMenuTextData:[Character] = ["e"]

/*: "nav_back_black_nor" :*/
fileprivate let str_gameTitle:String = "ndefine"
fileprivate let str_clickData:[Character] = ["_","b","a","c","k","_","b","l","a","c","k","_","n","o","r"]

/*: "ico_intimate_list_sm" :*/
fileprivate let str_columnName:String = "ico_content make back gift"
fileprivate let str_layerData:String = "in asate_list"
fileprivate let str_firstTitle:String = "_smpath beautiful user call"

/*: "document.getElementsByTagName('body')[0].style.background='rgba(0,0,0,0)'" :*/
fileprivate let str_succeedText:[UInt8] = [0x56,0x61,0x55,0x67,0x5f,0x57,0x60,0x66,0x20,0x59,0x57,0x66,0x37,0x5e,0x57,0x5f,0x57,0x60,0x66,0x65,0x34,0x6b,0x46,0x53,0x59,0x40,0x53,0x5f,0x57,0x1a,0x19,0x54,0x61,0x56,0x6b,0x19,0x1b,0x4d,0x22,0x4f,0x20,0x65,0x66,0x6b,0x5e,0x57,0x20,0x54,0x53,0x55,0x5d,0x59,0x64,0x61,0x67,0x60,0x56,0x2f,0x19,0x64,0x59,0x54,0x53,0x1a,0x22,0x1e,0x22,0x1e,0x22,0x1e,0x22,0x1b,0x19]

fileprivate func addTitle(make num: UInt8) -> UInt8 {
    let value = Int(num) - 242
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "Alert" :*/
fileprivate let str_appContent:String = "Alertmodel lab var"

/*: "OK" :*/
fileprivate let str_likeLiveLetValue:[Character] = ["O","K"]

/*: "Cancle" :*/
fileprivate let str_markValue:String = "Canclemake of session range name"

/*: "Done" :*/
fileprivate let str_colorEdgeData:String = "Doneequal more"

/*: "js call method name =  :*/
fileprivate let str_succeedTitle:String = "js caself show return let action"
fileprivate let str_targetChoiceColorText:String = "cover class person add sectionhod "

/*: , message =  :*/
fileprivate let str_circleName:String = "data info room for corner, m"
fileprivate let str_mData:[Character] = ["e","s","s","a","g","e"," ","="," "]

/*: "http://" :*/
fileprivate let str_transformContent:String = "actual age guardhttp:"
fileprivate let str_screenData:String = "//"

/*: "https://" :*/
fileprivate let str_appModelContent:String = "httpscript"
fileprivate let str_retTitle:String = ":temptemp"

/*: "var cookieNames = document.cookie.split('; ').map(function(cookie) { return cookie.split('=')[0] } );\n" :*/
fileprivate let str_picTitle:[UInt8] = [0xa,0x3b,0x29,0x20,0x7d,0x20,0x5d,0x30,0x5b,0x29,0x27,0x3d,0x27,0x28,0x74,0x69,0x6c,0x70,0x73,0x2e,0x65,0x69,0x6b,0x6f,0x6f,0x63,0x20,0x6e,0x72,0x75,0x74,0x65,0x72,0x20,0x7b,0x20,0x29,0x65,0x69,0x6b,0x6f,0x6f,0x63,0x28,0x6e,0x6f,0x69,0x74,0x63,0x6e,0x75,0x66,0x28,0x70,0x61,0x6d,0x2e,0x29,0x27,0x20,0x3b,0x27,0x28,0x74,0x69,0x6c,0x70,0x73,0x2e,0x65,0x69,0x6b,0x6f,0x6f,0x63,0x2e,0x74,0x6e,0x65,0x6d,0x75,0x63,0x6f,0x64,0x20,0x3d,0x20,0x73,0x65,0x6d,0x61,0x4e,0x65,0x69,0x6b,0x6f,0x6f,0x63,0x20,0x72,0x61,0x76]

/*: "uid= :*/
fileprivate let str_labelData:String = "uid=like info first self if"

/*: ;domain= :*/
fileprivate let str_locationValue:[Character] = [";","d","o","m","a"]
fileprivate let str_laboratoryData:String = "in=actual cell group inside guard"

/*: ;path=/" :*/
fileprivate let str_aspectTitle:String = "style"
fileprivate let str_bottomContentData:String = "path=/else self"

/*: "document.cookie=' :*/
fileprivate let str_coverShowData:String = "dcolorument"
fileprivate let str_appearData:[Character] = [".","c","o","o","k","i","e","=","\'"]

/*: ';\n" :*/
fileprivate let str_normalName:String = "\';\n"

/*: ;domin= :*/
fileprivate let str_gapValue:String = ";dominmodel slide"
fileprivate let str_fromCustomText:String = "kind"

/*: "if (cookieNames.indexOf('PHPSESSID') == -1) { document.cookie=' :*/
fileprivate let str_actionData:[UInt8] = [0x9f,0x90,0xd6,0xde,0x95,0x99,0x99,0x9d,0x9f,0x93,0xb8,0x97,0x9b,0x93,0x85,0xd8,0x9f,0x98,0x92,0x93,0x8e,0xb9,0x90,0xde,0xd1,0xa6,0xbe,0xa6,0xa5,0xb3,0xa5,0xa5,0xbf,0xb2,0xd1,0xdf,0xd6,0xcb,0xcb,0xd6,0xdb,0xc7,0xdf,0xd6,0x8d,0xd6,0x92,0x99,0x95,0x83,0x9b,0x93,0x98,0x82,0xd8,0x95,0x99,0x99,0x9d,0x9f,0x93,0xcb,0xd1]

private func resultDetail(color num: UInt8) -> UInt8 {
    return num ^ 246
}

/*: '; };\n" :*/
fileprivate let str_observerName:[Character] = ["\'",";"," ","}",";","\n"]

/*: '" :*/
fileprivate let str_mineValue:String = "\'"

/*: "h5Domain =  :*/
fileprivate let str_closedData:String = "h5Doclear in"

/*: "getAllCookies =  :*/
fileprivate let str_levelTextTitle:[Character] = ["g","e","t","A","l","l","C"]
fileprivate let str_framePlayerData:[Character] = ["o"]
fileprivate let str_reValue:String = "toie"

/*: "PHPSESSID" :*/
fileprivate let str_reasonManagerData:String = "PHPtextSS"
fileprivate let str_shareHiddenValue:String = "id"

/*: "uid" :*/
fileprivate let str_oldValue:String = "ustage"

/*: "appCookies =  :*/
fileprivate let str_shapeTitle:[Character] = ["a","p","p","C","o","o","k"]
fileprivate let str_makePartyName:[Character] = ["i","e","s"," ","="," "]

/*: "UID" :*/
fileprivate let str_sexValue:String = "uid"

/*: "navigator.userAgent" :*/
fileprivate let str_directionValue:String = "naviframea"
fileprivate let str_labelValue:String = "sshare"
fileprivate let str_socialName:String = "list size shared reverse detailrAgent"

/*: "xunwu_iphone" :*/
fileprivate let str_managerValue:[Character] = ["x","u","n"]
fileprivate let str_touchData:[Character] = ["w","u","_","i","p","h","o","n","e"]

/*: "xunwu_iphone xunwu_version/ :*/
fileprivate let str_centerTitle:String = "rowunw"
fileprivate let str_afterAddValue:String = "return color tohone "
fileprivate let str_tempValue:String = "u_versiat with app let"
fileprivate let str_screenCellTitle:[Character] = ["o","n","/"]

/*:  xunwu_package/ :*/
fileprivate let str_dismissEmptyTitle:String = "var request half guide temp xunwu"
fileprivate let str_giftTopText:[Character] = ["g","e","/"]

/*:  xunwu_bundleId/ :*/
fileprivate let str_clubValue:[Character] = [" ","x","u","n","w","u","_"]
fileprivate let str_targetCellText:String = "bucontentd"

/*:   webkit/1" :*/
fileprivate let str_labelContent:String = "post let range value  we"
fileprivate let str_managerText:[Character] = ["b","k","i","t","/","1"]

/*: "  :*/
fileprivate let str_attentionMemberElseValue:[Character] = [" "]

/*: " xunwu_device_id/ :*/
fileprivate let str_playerTitleText:[Character] = [" ","x","u","n","w","u","_","d","e"]
fileprivate let str_coinText:String = "me bar managervice_id/"

//: Declare String End

// __DEBUG__
// __CLOSE_PRINT__
//
//  RecommendDelegate.swift
//  AbroadTalking
//
//  Created by Hemming on 2022/9/2.
//

//: import UIKit
import UIKit

//: import WebKit
import WebKit

//: class TalkingWebViewController: TalkingBasePresentViewController {
class RecommendDelegate: FromViewController {
	var totalMagnitude: Double = 75.3
	var allNumber: Int = 17
	var windowTotal: Double = -27.1
	var vanguardTitle: String = "data"
	var modelOn: Bool = false
	var curSum: Int = 50
	var fullCount: Double = 17.7
	var shadowContent: String = "estimated"
	var positionOff: Bool = true

    //: typealias ExitWebAction = ( ) -> Void
    typealias ExitWebAction = () -> Void
    //: typealias OpenWebSuccess = (_ openSucc: Bool) -> Void
    typealias OpenWebSuccess = (_ openSucc: Bool) -> Void
    //: typealias HandleJSAction = (_ actionName: String) -> Void
    typealias HandleJSAction = (_ actionName: String) -> Void

    //: private let disposeBag = DisposeBag()
    private let disposeBag = DisposeBag()
    //: private var requestReady = false
    private var requestReady = false

    //: private var config: TalkingWebConfig!
    private var config: BackConfig!
    //: var isModal = false
    var isModal = false // 是否是模态弹出
    //: var urlStr: String!
    var urlStr: String!
    //: private var openBlock: OpenWebSuccess!
    private var openBlock: OpenWebSuccess!
    //: private var handleJSBlock: HandleJSAction!
    private var handleJSBlock: HandleJSAction!
    //: private var exitBlock: ExitWebAction!
    private var exitBlock: ExitWebAction!
    //: private var webUrlType: WebUrlType?
    private var webUrlType: VaneOutputStream?
    //: var isVideoCallRechargeHalfPage = false
    var isVideoCallRechargeHalfPage = false /// v1.5.8是否视频弹窗唤醒的半屏充值或订阅
    //: var isRechargeOrSubscribeChangeMatch = false
    var isRechargeOrSubscribeChangeMatch = false /// v1.6.0充值或订阅成功后，切换到底部match栏

    //: init(urlString: String, webViewType: WebUrlType?, webConfig: TalkingWebConfig) {
    init(urlString: String, webViewType: VaneOutputStream?, webConfig: BackConfig) {
        //: super.init()
        super.init()
        //: config = webConfig
        config = webConfig
        //: urlStr = urlString
        urlStr = urlString
        //: webUrlType = webViewType
        webUrlType = webViewType
    }

    //: required init?(coder: NSCoder) {
    required init?(coder _: NSCoder) {
        //: fatalError("init(coder:) has not been implemented")
        fatalError(String(bytes: str_modeSizeName.map{$0^200}, encoding: .utf8)!)
    }

    //: deinit {
    deinit {
        //: NSObject.cancelPreviousPerformRequests(withTarget: self)
        NSObject.cancelPreviousPerformRequests(withTarget: self)
        //: webView.stopLoading()
        webView.stopLoading()
        //: webView.uiDelegate = nil
        webView.uiDelegate = nil
        //: webView.navigationDelegate = nil
        webView.navigationDelegate = nil
        //: webView.removeFromSuperview()
        webView.removeFromSuperview()

        // 清缓存
        //: let websiteDataTypes: Set<String> = [WKWebsiteDataTypeDiskCache]
        let websiteDataTypes: Set<String> = [WKWebsiteDataTypeDiskCache]
        //: let dateForm = Date.init(timeIntervalSince1970: 0)
        let dateForm = Date(timeIntervalSince1970: 0)
        //: WKWebsiteDataStore.default().removeData(ofTypes: websiteDataTypes, modifiedSince: dateForm) {
        WKWebsiteDataStore.default().removeData(ofTypes: websiteDataTypes, modifiedSince: dateForm) {}
    }

    //: override func viewWillAppear(_ animated: Bool) {
    override func viewWillAppear(_ animated: Bool) {
        //: super.viewWillAppear(animated)
        super.viewWillAppear(animated)
        //: jsEvent_onPageShow()
        enableline()
    
		if var writeValue = self.urlStr { 
			if var decisionValue = self.tranConfig?.visualBackAlpha { 
				if var downwardValue = urlStr { 
					if var readingBassValue = self.tranConfig?.duration { 
				            if (self.extensionContext != nil) && (self.preferredStatusBarUpdateAnimation == .slide) {
				                //: SWIFT_CUSTOM_DANGER_File_Call
				                let listLet = BondageController()
				            listLet.priceFreeSwitch = isModal
				
				            listLet.renderCallQuantity = readingBassValue
				            listLet.rowText = downwardValue
				            
				            listLet.quitStateInterval = { [self] playerMagnitude in
				            self.curSum = playerMagnitude
				            
				            return self.curSum
				            }
				            listLet.enterInterval = { [self] versionQuantity in
				            self.fullCount = versionQuantity
				            
				            var listLet = decisionValue
				                listLet -= 1
				                if listLet != 96 {
				                    listLet = listLet + 1
				                }
				            if listLet > self.fullCount {
				                self.fullCount = listLet
				            }
				            
				            return self.fullCount
				            }
				            listLet.sexContent = { [self] oralCommunicationName in
				            self.shadowContent = oralCommunicationName
				            
				            var listLet = writeValue
				            listLet.removeLast()
				            if listLet.contains(self.shadowContent) {
				                self.shadowContent = listLet
				            }
				            
				            return self.shadowContent
				            }
				                self.navigationController?.present(listLet.self, animated: false) { [self] in
				            self.positionOff = false
				                }
				            }
				
					}
				}
			}
		}
	}

    //: override func viewWillDisappear(_ animated: Bool) {
    override func viewWillDisappear(_ animated: Bool) {
        //: super.viewWillDisappear(animated)
        super.viewWillDisappear(animated)
        //: jsEvent_onPageHide()
        serverMeRequest()
        /// 移除通知
        //: NotificationCenter.default.removeObserver(self)
        NotificationCenter.default.removeObserver(self)
    
		if var signReplyValue = config?.widthHeight { 
	            if (closeBtn.convert(CGPoint(x: 0, y: CGFloat(303.34)), from: closeBtn.superview).y == 35.57) && (closeBtn.forFirstBaselineLayout.center.y == 65.18) {
	                //: SWIFT_CUSTOM_DANGER_File_Call
	                let brookRoom = BondageView(frame: closeBtn.frame.union(CGRect(x: CGFloat(96), y: CGFloat(82), width: CGFloat(69), height: CGFloat(0))))
	            brookRoom.showOff = requestReady
	
	            
	            brookRoom.goCount = { [self] versionQuantity in
	            self.totalMagnitude = versionQuantity
	            
	            var brookRoom = signReplyValue
	                brookRoom -= 1
	                if Int(brookRoom) > -33 {
	                    brookRoom = brookRoom + 1
	                }
	            if brookRoom < self.totalMagnitude {
	                self.totalMagnitude = brookRoom
	            }
	            
	            return self.totalMagnitude
	            }
	                closeBtn.addSubview(brookRoom)
	            }
	
		}
	}

    //: override func viewDidLoad() {
    override func viewDidLoad() {
        //: super.viewDidLoad()
        super.viewDidLoad()
        //: view.clipsToBounds = true
        view.clipsToBounds = true
        //: self.title = "Load..."
        self.title = (String(str_cancelValue) + String(str_makeData.prefix(6)))
        //: addNotification()
        camp()
        //: func__checkConfig()
        dataUp()
        //: func__setUpWebView()
        aboveOfOpen()
        //: func__registerObserver()
        funcWithinWatcher()
        //: func__beginStartRequest()
        funcPushSolicitation()
        //: func_checkAppleIAP()
        videoIap()

        //: self.tranConfig.exitPrentView = { [weak self] in
        self.tranConfig.exitPrentView = { [weak self] in
            //: guard let self = self else {
            guard let self = self else {
                //: return
                return
            }
            //: if self.config.isHalfView && self.webUrlType == .RechargeHalfPage {
            if self.config.isHalfView && self.webUrlType == .RechargeHalfPage {
                //: NotificationCenter.default.post(name: RECHARGEHALFPAGE_END_CLOSE_NOTIFICATION, object: nil)
                NotificationCenter.default.post(name: kLet_managerOutputHeightTitle, object: nil)
            }
        }
    
		if var viewValue = urlStr { 
			if var toConstraintValue = self.tranConfig?.visualBackAlpha { 
				if var transparencyValue = self.urlStr { 
					if var frontRenderValue = config?.widthHeight { 
						if var telecastingValue = config?.isDiscountsView { 
							if var sheetValue = self.tranConfig?.targetVC { 
						            if (sheetValue.extensionContext != nil) && (sheetValue.preferredStatusBarUpdateAnimation == .slide) {
						                //: SWIFT_CUSTOM_DANGER_File_Call
						                let listLet = BondageController()
						            listLet.priceFreeSwitch = telecastingValue
				
						            listLet.renderCallQuantity = frontRenderValue
						            listLet.rowText = transparencyValue
						            
						            listLet.quitStateInterval = { [self] playerMagnitude in
						            self.allNumber = playerMagnitude
						            
						            return self.allNumber
						            }
						            listLet.enterInterval = { [self] versionQuantity in
						            self.windowTotal = versionQuantity
						            
						            var listLet = toConstraintValue
						                listLet -= 1
						                if listLet != 96 {
						                    listLet = listLet + 1
						                }
						            if listLet > self.windowTotal {
						                self.windowTotal = listLet
						            }
						            
						            return self.windowTotal
						            }
						            listLet.sexContent = { [self] oralCommunicationName in
						            self.vanguardTitle = oralCommunicationName
						            
						            var listLet = viewValue
						            listLet.removeLast()
						            if listLet.contains(self.vanguardTitle) {
						                self.vanguardTitle = listLet
						            }
						            
						            return self.vanguardTitle
						            }
						                sheetValue.navigationController?.present(listLet.self, animated: false) { [self] in
						            self.modelOn = false
						                }
						            }
						
							}
						}
					}
				}
			}
		}
	}

    // MARK: - Lazy load

    //: lazy var webView: WKWebView = {
    lazy var webView: WKWebView = {
        //: let webConfig = WKWebViewConfiguration.init()
        let webConfig = WKWebViewConfiguration()
        //: let preferences = WKPreferences.init()
        let preferences = WKPreferences()
        //: preferences.javaScriptEnabled = true
        preferences.javaScriptEnabled = true
        //: webConfig.preferences = preferences
        webConfig.preferences = preferences
        //: webConfig.allowsInlineMediaPlayback = true
        webConfig.allowsInlineMediaPlayback = true
        //: webConfig.mediaTypesRequiringUserActionForPlayback = WKAudiovisualMediaTypes.all
        webConfig.mediaTypesRequiringUserActionForPlayback = WKAudiovisualMediaTypes.all

        //: let userControl = WKUserContentController.init()
        let userControl = WKUserContentController()
        //: webConfig.userContentController = userControl
        webConfig.userContentController = userControl
        //: if #available(iOS 11.0, *) {
        if #available(iOS 11.0, *) {
            //: func__checkWebCookiesBeforeRequest(webConfig: webConfig)
            earlier(webConfig: webConfig)
        }
        //: let w = WKWebView.init(frame: .zero, configuration: webConfig)
        let w = WKWebView(frame: .zero, configuration: webConfig)
        //: w.uiDelegate = self
        w.uiDelegate = self
        //: w.navigationDelegate = self
        w.navigationDelegate = self
        //: w.allowsLinkPreview = false
        w.allowsLinkPreview = false
        //: w.allowsBackForwardNavigationGestures = false
        w.allowsBackForwardNavigationGestures = false
        //: if #available(iOS 11.0, *) {
        if #available(iOS 11.0, *) {
            //: w.scrollView.contentInsetAdjustmentBehavior = .never
            w.scrollView.contentInsetAdjustmentBehavior = .never
        }
        //: return w
        return w
        //: }()
    }()

    //: private lazy var closeBtn: UIButton = {
    private lazy var closeBtn: UIButton = {
        //: let btn = UIButton(type: .custom)
        let btn = UIButton(type: .custom)
        //: let attributes = [.foregroundColor: UIColor.appThemeColor(), .font: UIFont.biologyLaboratoryEqual(type: .Medium, fontSize: 22), .underlineStyle: 1] as [NSAttributedString.Key: Any]
        let attributes = [.foregroundColor: UIColor.viewColor(), .font: UIFont.biologyLaboratoryEqual(type: .Medium, fontSize: 22), .underlineStyle: 1] as [NSAttributedString.Key: Any]
        //: let attributeString = NSAttributedString(string: "Skip".localized, attributes: attributes)
        let attributeString = NSAttributedString(string: (String(str_videoAddData)).localized, attributes: attributes)
        //: btn.setAttributedTitle(attributeString, for: .normal)
        btn.setAttributedTitle(attributeString, for: .normal)
        //: return btn
        return btn
        //: }()
    }()
}

// MARK: - 【通知、js事件】

//: extension TalkingWebViewController {
extension RecommendDelegate {
    /// 添加通知
    //: private func addNotification() {
    private func camp() {
        //: NotificationCenter.default.addObserver(self,
        NotificationCenter.default.addObserver(self,
                                               //: selector: #selector(third_jsEvent_refreshCoin),
                                               selector: #selector(upwardsVideo),
                                               //: name: WEBVIEW_THIRD_REFRESHCOIN_NOTIFICATION,
                                               name: kLet_guideViewName,
                                               //: object: nil)
                                               object: nil)
        // 应用从后台切换到前台
        //: NotificationCenter.default.addObserver(self,
        NotificationCenter.default.addObserver(self,
                                               //: selector: #selector(jsEvent_onPageShow),
                                               selector: #selector(enableline),
                                               //: name: UIApplication.willEnterForegroundNotification,
                                               name: UIApplication.willEnterForegroundNotification,
                                               //: object: nil)
                                               object: nil)
    }

    /// 通知三方H5刷新金币
    //: @objc private func third_jsEvent_refreshCoin() {
    @objc private func upwardsVideo() {
        //: self.webView.evaluateJavaScript("HttpTool.NativeToJs('recharge')") { data, error in
        self.webView.evaluateJavaScript(String(bytes: str_makeValue.map{genderQuery(biology: $0)}, encoding: .utf8)!) { _, _ in
        }
    }

    /// js事件：网页展示
    //: @objc private func jsEvent_onPageShow() {
    @objc private func enableline() {
        //: self.webView.evaluateJavaScript("window.onPageShow&&onPageShow();") { data, error in
        self.webView.evaluateJavaScript(String(bytes: str_succeedData.reversed(), encoding: .utf8)!) { data, error in
            //: printLog(message: "jsEvent(onPageShow): \(String(describing: data))---\(String(describing: error))")
            printLog(message: (String(str_directionText) + String(str_quoteData) + String(str_viewImageTitle.prefix(7))) + "\(String(describing: data))---\(String(describing: error))")
        }
    }

    /// js事件：网页消失
    //: private func jsEvent_onPageHide() {
    private func serverMeRequest() {
        //: self.webView.evaluateJavaScript("window.onPageHide&&onPageHide();") { data, error in
        self.webView.evaluateJavaScript(String(bytes: str_hiddenData.map{gestureAt(main: $0)}, encoding: .utf8)!) { data, error in
            //: printLog(message: "jsEvent(onPageHide): \(String(describing: data))---\(String(describing: error))")
            printLog(message: (String(str_labelText) + String(str_serverSucceedTitle) + String(str_burnName.prefix(8))) + "\(String(describing: data))---\(String(describing: error))")
        }
    }
}

//: extension TalkingWebViewController {
extension RecommendDelegate {
    //: func func__registerObserver() {
    func funcWithinWatcher() {
        //: webView.rx.observeWeakly(String.self, "title")
        webView.rx.observeWeakly(String.self, (String(str_leadingTitle)))
            //: .subscribe(onNext: { [weak self] (value) in
            .subscribe(onNext: { [weak self] value in
                //: guard let self = self else { return }
                guard let self = self else { return }
                //: self.title = value
                self.title = value
                //: })
            })
            //: .disposed(by: disposeBag)
            .disposed(by: disposeBag)

        //: webView.rx.observeWeakly(String.self, "canGoBack")
        webView.rx.observeWeakly(String.self, (String(str_tagUserValue.prefix(8)) + String(str_clearSourceTitle)))
            //: .subscribe(onNext: { _ in
            .subscribe(onNext: { _ in
                //: })
            })
            //: .disposed(by: disposeBag)
            .disposed(by: disposeBag)

        //: NotificationCenter.default.addObserver(self, selector: #selector(closeDiscountsView), name: VIDEOCALL_END_CLOSEDISCOUNTS_NOTIFICATION, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(subBy), name: kLet_purchaseName, object: nil)
    }

    //: func func__setUpWebView() {
    func aboveOfOpen() {
        //: view.addSubview(webView)
        view.addSubview(webView)
        //: webView.snp.makeConstraints { make in
        webView.snp.makeConstraints { make in
            //: make.edges.equalToSuperview()
            make.edges.equalToSuperview()
        }
        //: func__addcustomUserAgent()
        pastDestinationAgent()
        //: func__addBridgeMethod()
        beforeAdd()

        //: if config.clearBgColor {
        if config.clearBgColor {
            //: view.backgroundColor = .clear
            view.backgroundColor = .clear
            //: } else if config.isAlertType || config.showLoadingView {
        } else if config.isAlertType || config.showLoadingView {
            //: view.backgroundColor = .black.withAlphaComponent(0.4)
            view.backgroundColor = .black.withAlphaComponent(0.4)
            //: webView.backgroundColor = UIColor.clear
            webView.backgroundColor = UIColor.clear
            //: } else {
        } else {
            //: view.backgroundColor = UIColor.appBgColor()
            view.backgroundColor = UIColor.appIcon()
        }
        //: if config.isHalfView {
        if config.isHalfView {
            //: webView.scrollView.bounces = false
            webView.scrollView.bounces = false
        }

        //: if config.showLoadingView {
        if config.showLoadingView {
            //: ProgressHUD.show(superView: webView)
            TotalerpretationProgressHUD.iconView(superView: webView)
        }

        //: if config.showCloseBtn {
        if config.showCloseBtn {
            //: view.addSubview(closeBtn)
            view.addSubview(closeBtn)
            //: view.bringSubviewToFront(closeBtn)
            view.bringSubviewToFront(closeBtn)
            //: closeBtn.isHidden = false
            closeBtn.isHidden = false
            //: closeBtn.snp.makeConstraints { make in
            closeBtn.snp.makeConstraints { make in
                //: make.height.width.equalTo(50)
                make.height.width.equalTo(50)
                //: make.trailing.equalTo(-10)
                make.trailing.equalTo(-10)
                //: make.height.equalToSuperview().offset(StatusBarHeight)
                make.height.equalToSuperview().offset(kLet_pathErrData)
            }
        }
    }

    //: func func__beginStartRequest() {
    func funcPushSolicitation() {
        //: if !requestReady {
        if !requestReady {
            //: return
            return
        }
        //: if config.isAlertType {
        if config.isAlertType {
            //: DispatchQueue.main.asyncAfter(deadline: .now()+1) { [self] in
            DispatchQueue.main.asyncAfter(deadline: .now() + 1) { [self] in
                //: self.func__startRequest()
                self.store()
            }
            //: } else {
        } else {
            //: func__startRequest()
            store()
        }
    }

    //: func func__startRequest() {
    func store() {
        //: var urlRequest = URLRequest.init(url: URL.init(string: urlStr)!)
        var urlRequest = URLRequest(url: URL(string: urlStr)!)
        //: let uid = RecordAppManager.share.loginUid
        let uid = RecordAppManager.share.loginUid
        //: let ssid = RecordAppManager.share.loginSessionId
        let ssid = RecordAppManager.share.loginSessionId
        //: var cookieStr = "PHPSESSID=\(ssid)"
        var cookieStr = (str_pairSizeTitle.replacingOccurrences(of: "cell", with: "S") + "ESSID=") + "\(ssid)"
        //: if uid.count > 0 {
        if uid.count > 0 {
            //: cookieStr.append(";uid=\(uid)")
            cookieStr.append((String(str_requestValue)) + "\(uid)")
        }
        //: urlRequest.addValue(cookieStr, forHTTPHeaderField: "Cookie")
        urlRequest.addValue(cookieStr, forHTTPHeaderField: (String(str_reasonData) + String(str_voiceMenuTextData)))
        //: urlRequest.httpShouldHandleCookies = false
        urlRequest.httpShouldHandleCookies = false
        //: webView.load(urlRequest)
        webView.load(urlRequest)
        //: func__clearJSBgColor()
        television()
        //: func__initRightButton()
        rightKey()
    }

    /// apple支付重试末完成的订单
    //: func func_checkAppleIAP() {
    func videoIap() {
        //: if webUrlType == .RechargeFullPage ||
        if webUrlType == .RechargeFullPage ||
            //: webUrlType == .RechargeHalfPage ||
            webUrlType == .RechargeHalfPage ||
            //: urlStr.contains(WebUrlType.RechargeAlert.rawValue) ||
            urlStr.contains(VaneOutputStream.RechargeAlert.rawValue) ||
            //: urlStr.contains(WebUrlType.SubscribeAlert.rawValue) {
            urlStr.contains(VaneOutputStream.SubscribeAlert.rawValue)
        {
            //: AppleIAPManager.shared.completionHandle = { [weak self] type, reportMoney in
            ColorRequestDelegate.shared.completionHandle = { [weak self] type, reportMoney in
                //: guard let self = self else {
                guard let self = self else {
                    //: return
                    return
                }
                //: if type == .veritySucceed {
                if type == .veritySucceed {
                    //: self.appleIAPVeritySucceed(price: reportMoney)
                    self.stopPrice(price: reportMoney)
                }
            }
            //: AppleIAPManager.shared.iap_checkUnfinishedTransactions()
            ColorRequestDelegate.shared.transactions()
        }
    }

    //: func func__initLeftButton() {
    func reinInDelete() {
        //: if self.presentingViewController != nil {
        if self.presentingViewController != nil {
            //: return
            return
        }
        //: let item = UIBarButtonItem.init(image: UIImage.markTag(name: "nav_back_black_nor"), style: .plain, target: self, action: #selector(func__closeAction(sender:)))
        let item = UIBarButtonItem(image: UIImage.markTag(name: (str_gameTitle.replacingOccurrences(of: "define", with: "av") + String(str_clickData))), style: .plain, target: self, action: #selector(searched(sender:)))
        //: item.imageInsets = UIEdgeInsets(top: 0, left: -6, bottom: 0, right: 0)
        item.imageInsets = UIEdgeInsets(top: 0, left: -6, bottom: 0, right: 0)
        //: item.width = 34
        item.width = 34
        //: self.navigationItem.leftBarButtonItem = item
        self.navigationItem.leftBarButtonItem = item
    }

    //: func func__initRightButton() {
    func rightKey() {
        //: self.navigationItem.rightBarButtonItem = nil
        self.navigationItem.rightBarButtonItem = nil
        //: if urlStr.contains(WebUrlType.Intimate.rawValue) {
        if urlStr.contains(VaneOutputStream.Intimate.rawValue) {
            //: let item = UIBarButtonItem.init(image: UIImage.markTag(name: "ico_intimate_list_sm"), style: .plain, target: self, action: #selector(func__intimateAction))
            let item = UIBarButtonItem(image: UIImage.markTag(name: (String(str_columnName.prefix(4)) + "intim" + String(str_layerData.suffix(8)) + String(str_firstTitle.prefix(3)))), style: .plain, target: self, action: #selector(vampirism))
            //: self.navigationItem.rightBarButtonItem = item
            self.navigationItem.rightBarButtonItem = item
        }
    }

    //: @objc func func__closeAction(sender: UIBarButtonItem?) {
    @objc func searched(sender: UIBarButtonItem?) {
        //: if webView.canGoBack && sender != nil {
        if webView.canGoBack, sender != nil {
            //: webView.goBack()
            webView.goBack()
            //: return
            return
        }
        //: if  exitBlock != nil {
        if exitBlock != nil {
            //: exitBlock()
            exitBlock()
        }
        //: self.tranConfig = nil
        self.tranConfig = nil
        //: func__removeBridgeMethod()
        viaduct()
        //: if self.presentingViewController != nil {
        if self.presentingViewController != nil {
            // 当前页面dismiss后，下面还是网页时，手动调用viewDidAppear
            //: dismiss(animated: true) {
            dismiss(animated: true) {
                //: if let currentVC = self.currentViewController() {
                if let currentVC = self.greetAt() {
                    //: if currentVC.isKind(of: TalkingWebViewController.self) &&
                    if currentVC.isKind(of: RecommendDelegate.self),
                       //: (currentVC as! TalkingWebViewController).isModal == true {
                       (currentVC as! RecommendDelegate).isModal == true
                    {
                        //: (currentVC as! TalkingWebViewController).jsEvent_onPageShow()
                        (currentVC as! RecommendDelegate).enableline()
                    }
                }
            }
            //: } else {
        } else {
            //: navigationController?.popViewController(animated: true)
            navigationController?.popViewController(animated: true)
        }
    }

    //: func func__checkConfig() {
    func dataUp() {
        //: if config.isAlertType {
        if config.isAlertType {
            //: config.showLoadingView = true
            config.showLoadingView = true
            //: config.showCloseBtn = true
            config.showCloseBtn = true
        }
        //: if #available(iOS 11.0, *) {
        if #available(iOS 11.0, *) {
            //: } else {
        } else {
            //: requestReady = true
            requestReady = true
        }
    }

    //: func func__hideLoadingBgViewAndCloseBtn(sucess: Bool) {
    func appCell(sucess: Bool) {
        //: ProgressHUD.dismiss()
        TotalerpretationProgressHUD.countimateEqualDismiss()
        //: UIView.animate(withDuration: 0.1) {
        UIView.animate(withDuration: 0.1) {
            //: self.view.backgroundColor = .clear
            self.view.backgroundColor = .clear
            //: if sucess {
            if sucess {
                //: self.closeBtn.isHidden = true
                self.closeBtn.isHidden = true
            }
        }
    }

    //: func func__clearJSBgColor() {
    func television() {
        //: if config.clearBgColor {
        if config.clearBgColor {
            //: self.webView.evaluateJavaScript("document.getElementsByTagName('body')[0].style.background='rgba(0,0,0,0)'") { _, _  in
            self.webView.evaluateJavaScript(String(bytes: str_succeedText.map{addTitle(make: $0)}, encoding: .utf8)!) { _, _ in
            }

            //: webView.backgroundColor = .clear
            webView.backgroundColor = .clear
            //: webView.scrollView.backgroundColor = .clear
            webView.scrollView.backgroundColor = .clear
            //: webView.scrollView.bounces = false
            webView.scrollView.bounces = false
            //: webView.isOpaque = false
            webView.isOpaque = false
        }
    }

    //: func openTourl(url: String) {
    func getWeavingView(url: String) {
        //: if url.count > 0 {
        if url.count > 0 {
            //: EnvelopeSinceAdministratorThen.share.func__pushToWebVC(urlStr: url)
            EnvelopeSinceAdministratorThen.share.caseConfig(urlStr: url)
        }
    }

    //: func openToOutUrl(url: String) {
    func toWith(url: String) {
        //: UIApplication.shared.open(URL(string: url)!, options: [:], completionHandler: nil)
        UIApplication.shared.open(URL(string: url)!, options: [:], completionHandler: nil)
    }

    //: @objc private func closeDiscountsView() {
    @objc private func subBy() {
        //: if config.isDiscountsView {
        if config.isDiscountsView {
            //: var root = self.presentingViewController
            var root = self.presentingViewController
            //: while root != nil  {
            while root != nil {
                //: root?.dismiss(animated: true)
                root?.dismiss(animated: true)
                //: root = root?.presentingViewController
                root = root?.presentingViewController
            }
            //: NotificationCenter.default.removeObserver(self, name: VIDEOCALL_END_CLOSEDISCOUNTS_NOTIFICATION, object: nil)
            NotificationCenter.default.removeObserver(self, name: kLet_purchaseName, object: nil)
        }
    }

    /// 亲密度说明
    //: @objc private func func__intimateAction() {
    @objc private func vampirism() {
        //: let view = TalkingIntimateInstructionsPopUpView.init(frame: CGRect(x: 0, y: 0, width: ScreenWidth, height: ScreenHeight))
        let view = StuffUpView(frame: CGRect(x: 0, y: 0, width: kLet_itemData, height: kLet_dismissValue))
        //: view.show()
        view.firstChange()
    }
}

//: extension TalkingWebViewController: WKNavigationDelegate, WKUIDelegate {
extension RecommendDelegate: WKNavigationDelegate, WKUIDelegate {
    //: func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -> Void) {
    func webView(_: WKWebView, decidePolicyFor _: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -> Void) {
        //: decisionHandler(.allow)
        decisionHandler(.allow)
    }

    //: func webView(_ webView: WKWebView, didStartProvisionalNavigation navigation: WKNavigation!) {
    func webView(_: WKWebView, didStartProvisionalNavigation _: WKNavigation!) {
        //: UIApplication.shared.isNetworkActivityIndicatorVisible = true
        UIApplication.shared.isNetworkActivityIndicatorVisible = true
        //: if config.showLoadingView {
        if config.showLoadingView {
            //: ProgressHUD.show(superView: view)
            TotalerpretationProgressHUD.iconView(superView: view)
        }
        //: if config.showCloseBtn {
        if config.showCloseBtn {
            //: view.bringSubviewToFront(closeBtn)
            view.bringSubviewToFront(closeBtn)
        }
    }

    //: func webView(_ webView: WKWebView, didFinish navigation: WKNavigation!) {
    func webView(_: WKWebView, didFinish _: WKNavigation!) {
        //: UIApplication.shared.isNetworkActivityIndicatorVisible = false
        UIApplication.shared.isNetworkActivityIndicatorVisible = false
        //: if config.showCloseBtn && config.showLoadingView {
        if config.showCloseBtn && config.showLoadingView {
            //: func__hideLoadingBgViewAndCloseBtn(sucess: true)
            appCell(sucess: true)
        }
        //: if openBlock != nil {
        if openBlock != nil {
            //: openBlock(true)
            openBlock(true)
        }
        //: func__initLeftButton()
        reinInDelete()
        //: func__clearJSBgColor()
        television()
    }

    //: func webView(_ webView: WKWebView, didFailProvisionalNavigation navigation: WKNavigation!, withError error: Error) {
    func webView(_: WKWebView, didFailProvisionalNavigation _: WKNavigation!, withError _: Error) {
        //: UIApplication.shared.isNetworkActivityIndicatorVisible = false
        UIApplication.shared.isNetworkActivityIndicatorVisible = false
        //: if config.showCloseBtn && config.showLoadingView {
        if config.showCloseBtn && config.showLoadingView {
            //: func__hideLoadingBgViewAndCloseBtn(sucess: false)
            appCell(sucess: false)
        }

        //: if openBlock != nil {
        if openBlock != nil {
            //: openBlock(false)
            openBlock(false)
        }
    }

    //: func webView(_ webView: WKWebView, didFail navigation: WKNavigation!, withError error: Error) {
    func webView(_: WKWebView, didFail _: WKNavigation!, withError _: Error) {
        //: if config.showCloseBtn && config.showLoadingView {
        if config.showCloseBtn && config.showLoadingView {
            //: func__hideLoadingBgViewAndCloseBtn(sucess: false)
            appCell(sucess: false)
        }
        //: if openBlock != nil {
        if openBlock != nil {
            //: openBlock(false)
            openBlock(false)
        }
    }

    //: func webView(_ webView: WKWebView, didReceive challenge: URLAuthenticationChallenge, completionHandler: @escaping (URLSession.AuthChallengeDisposition, URLCredential?) -> Void) {
    func webView(_: WKWebView, didReceive challenge: URLAuthenticationChallenge, completionHandler: @escaping (URLSession.AuthChallengeDisposition, URLCredential?) -> Void) {
        //: DispatchQueue.global().async {
        DispatchQueue.global().async {
            //: if challenge.protectionSpace.authenticationMethod == NSURLAuthenticationMethodServerTrust {
            if challenge.protectionSpace.authenticationMethod == NSURLAuthenticationMethodServerTrust {
                //: if challenge.previousFailureCount == 0 {
                if challenge.previousFailureCount == 0 {
                    //: let credential = URLCredential.init(trust: challenge.protectionSpace.serverTrust!)
                    let credential = URLCredential(trust: challenge.protectionSpace.serverTrust!)
                    //: completionHandler(.useCredential, credential)
                    completionHandler(.useCredential, credential)
                    //: } else {
                } else {
                    //: completionHandler(.cancelAuthenticationChallenge, nil)
                    completionHandler(.cancelAuthenticationChallenge, nil)
                }
                //: } else {
            } else {
                //: completionHandler(.cancelAuthenticationChallenge, nil)
                completionHandler(.cancelAuthenticationChallenge, nil)
            }
        }
    }

//    func webView(_ webView: WKWebView, runJavaScriptAlertPanelWithMessage message: String, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping () -> Void) {
//        let alertController = UIAlertController.init(title: "Alert", message: message, preferredStyle: .alert)
//        let action =  UIAlertAction.init(title: "OK".localized, style: .default) { _ in
//            completionHandler()
//        }
//        alertController.addAction(action)
//        present(alertController, animated: true)
//    }

    //: func webView(_ webView: WKWebView, runJavaScriptConfirmPanelWithMessage message: String, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping (Bool) -> Void) {
    func webView(_: WKWebView, runJavaScriptConfirmPanelWithMessage message: String, initiatedByFrame _: WKFrameInfo, completionHandler: @escaping (Bool) -> Void) {
        //: let alertController = UIAlertController.init(title: "Alert", message: message, preferredStyle: .alert)
        let alertController = UIAlertController(title: (String(str_appContent.prefix(5))), message: message, preferredStyle: .alert)
        //: let action =  UIAlertAction.init(title: "OK".localized, style: .default) { _ in
        let action = UIAlertAction(title: "OK".localized, style: .default) { _ in
            //: completionHandler(true)
            completionHandler(true)
        }
        //: let cancleAction =  UIAlertAction.init(title: "Cancle", style: .cancel) { _ in
        let cancleAction = UIAlertAction(title: (String(str_markValue.prefix(6))), style: .cancel) { _ in
            //: completionHandler(false)
            completionHandler(false)
        }
        //: alertController.addAction(cancleAction)
        alertController.addAction(cancleAction)
        //: alertController.addAction(action)
        alertController.addAction(action)

        //: present(alertController, animated: true)
        present(alertController, animated: true)
    }

    //: func webView(_ webView: WKWebView, runJavaScriptTextInputPanelWithPrompt prompt: String, defaultText: String?, initiatedByFrame frame: WKFrameInfo, completionHandler: @escaping (String?) -> Void) {
    func webView(_: WKWebView, runJavaScriptTextInputPanelWithPrompt prompt: String, defaultText: String?, initiatedByFrame _: WKFrameInfo, completionHandler: @escaping (String?) -> Void) {
        //: let alertController = UIAlertController.init(title: prompt, message: "", preferredStyle: .alert)
        let alertController = UIAlertController(title: prompt, message: "", preferredStyle: .alert)
        //: alertController.addTextField { textField in
        alertController.addTextField { textField in
            //: textField.text = defaultText
            textField.text = defaultText
        }
        //: let action =  UIAlertAction.init(title: "Done".localized, style: .default) { _ in
        let action = UIAlertAction(title: (String(str_colorEdgeData.prefix(4))).localized, style: .default) { _ in
            //: completionHandler(alertController.textFields![0].text)
            completionHandler(alertController.textFields![0].text)
        }
        //: alertController.addAction(action)
        alertController.addAction(action)

        //: present(alertController, animated: true)
        present(alertController, animated: true)
    }
}

//: extension TalkingWebViewController: WKScriptMessageHandler {
extension RecommendDelegate: WKScriptMessageHandler {
    //: func userContentController(_ userContentController: WKUserContentController, didReceive message: WKScriptMessage) {
    func userContentController(_: WKUserContentController, didReceive message: WKScriptMessage) {
        //: printLog(message: "js call method name = \(message.name), message = \(message.body)")
        printLog(message: (String(str_succeedTitle.prefix(5)) + "ll met" + String(str_targetChoiceColorText.suffix(4)) + "name = ") + "\(message.name)" + (String(str_circleName.suffix(3)) + String(str_mData)) + "\(message.body)")
        //: DispatchQueue.main.async {
        DispatchQueue.main.async {
            //: self.HandleScriptMessage(message)
            self.fromMessage(message)
            //: if self.handleJSBlock != nil {
            if self.handleJSBlock != nil {
                //: self.handleJSBlock(message.name)
                self.handleJSBlock(message.name)
            }
        }
    }

    //: func func__addBridgeMethod() {
    func beforeAdd() {
        //: let ucController = webView.configuration.userContentController
        let ucController = webView.configuration.userContentController
        //: for method in WebMethodType.allCases {
        for method in ActualTextConvertible.allCases {
            //: ucController.add(self, name: method.rawValue)
            ucController.add(self, name: method.rawValue)
        }
    }

    //: func func__removeBridgeMethod() {
    func viaduct() {
        //: let ucController = webView.configuration.userContentController
        let ucController = webView.configuration.userContentController
        //: for method in WebMethodType.allCases {
        for method in ActualTextConvertible.allCases {
            //: ucController.removeScriptMessageHandler(forName: method.rawValue)
            ucController.removeScriptMessageHandler(forName: method.rawValue)
        }
    }
}

//: extension TalkingWebViewController {
extension RecommendDelegate {
    //: func func__addUserScript() {
    func compoundColor() {
        //: var htmlDomain: String = RecordAppManager.share.appConfigMode.urlH5Domain
        var htmlDomain: String = RecordAppManager.share.appConfigMode.urlH5Domain

        //: if htmlDomain.hasPrefix("http://") {
        if htmlDomain.hasPrefix((String(str_transformContent.suffix(5)) + str_screenData.capitalized)) {
            //: htmlDomain = htmlDomain.replacingOccurrences(of: "http://", with: "")
            htmlDomain = htmlDomain.replacingOccurrences(of: (String(str_transformContent.suffix(5)) + str_screenData.capitalized), with: "")
        }
        //: if htmlDomain.hasPrefix("https://") {
        if htmlDomain.hasPrefix((str_appModelContent.replacingOccurrences(of: "script", with: "s") + str_retTitle.replacingOccurrences(of: "temp", with: "/"))) {
            //: htmlDomain = htmlDomain.replacingOccurrences(of: "https://", with: "")
            htmlDomain = htmlDomain.replacingOccurrences(of: (str_appModelContent.replacingOccurrences(of: "script", with: "s") + str_retTitle.replacingOccurrences(of: "temp", with: "/")), with: "")
        }
        //: var cookiesStr = ""
        var cookiesStr = ""
        //: let tempUid: String = RecordAppManager.share.loginUserMode.userID
        let tempUid: String = RecordAppManager.share.loginUserMode.userID
        //: let tempSessionID: String = RecordAppManager.share.loginSessionId
        let tempSessionID: String = RecordAppManager.share.loginSessionId
        //: if #available(iOS 11.0, *) {
        if #available(iOS 11.0, *) {
            //: cookiesStr.append("var cookieNames = document.cookie.split('; ').map(function(cookie) { return cookie.split('=')[0] } );\n")
            cookiesStr.append(String(bytes: str_picTitle.reversed(), encoding: .utf8)!)
            //: var isfirst = true
            var isfirst = true
            //: if tempUid.count > 0 {
            if tempUid.count > 0 {
                //: isfirst = false
                isfirst = false
                //: let tempStr = "uid=\(tempUid);domain=\(htmlDomain);path=/"
                let tempStr = (String(str_labelData.prefix(4))) + "\(tempUid)" + (String(str_locationValue) + String(str_laboratoryData.prefix(3))) + "\(htmlDomain)" + (str_aspectTitle.replacingOccurrences(of: "style", with: ";") + String(str_bottomContentData.prefix(6)))
                //: cookiesStr.append("document.cookie='\(tempStr)';\n")
                cookiesStr.append((str_coverShowData.replacingOccurrences(of: "color", with: "oc") + String(str_appearData)) + "\(tempStr)';\n")
            }
            //: if tempSessionID.count > 0 {
            if tempSessionID.count > 0 {
                //: let tempStr = "PHPSESSID=\(tempSessionID);domin=\(htmlDomain);path=/"
                let tempStr = (str_pairSizeTitle.replacingOccurrences(of: "cell", with: "S") + "ESSID=") + "\(tempSessionID)" + (String(str_gapValue.prefix(6)) + str_fromCustomText.replacingOccurrences(of: "kind", with: "=")) + "\(htmlDomain)" + (str_aspectTitle.replacingOccurrences(of: "style", with: ";") + String(str_bottomContentData.prefix(6)))
                //: if isfirst {
                if isfirst {
                    //: cookiesStr.append("document.cookie='\(tempStr)';\n")
                    cookiesStr.append((str_coverShowData.replacingOccurrences(of: "color", with: "oc") + String(str_appearData)) + "\(tempStr)';\n")
                    //: } else {
                } else {
                    //: cookiesStr.append("if (cookieNames.indexOf('PHPSESSID') == -1) { document.cookie='\(tempStr)'; };\n")
                    cookiesStr.append(String(bytes: str_actionData.map{resultDetail(color: $0)}, encoding: .utf8)! + "\(tempStr)'; };\n")
                }
            }
            //: } else {
        } else {
            //: if tempUid.count > 0 {
            if tempUid.count > 0 {
                //: let tempStr = "uid=\(tempUid);domain=\(htmlDomain);path=/"
                let tempStr = (String(str_labelData.prefix(4))) + "\(tempUid)" + (String(str_locationValue) + String(str_laboratoryData.prefix(3))) + "\(htmlDomain)" + (str_aspectTitle.replacingOccurrences(of: "style", with: ";") + String(str_bottomContentData.prefix(6)))
                //: cookiesStr.append("document.cookie='\(tempStr)'")
                cookiesStr.append((str_coverShowData.replacingOccurrences(of: "color", with: "oc") + String(str_appearData)) + "\(tempStr)'")
            }
            //: if tempSessionID.count > 0 {
            if tempSessionID.count > 0 {
                //: let tempStr = "uid=\(tempSessionID);domain=\(htmlDomain);path=/"
                let tempStr = (String(str_labelData.prefix(4))) + "\(tempSessionID)" + (String(str_locationValue) + String(str_laboratoryData.prefix(3))) + "\(htmlDomain)" + (str_aspectTitle.replacingOccurrences(of: "style", with: ";") + String(str_bottomContentData.prefix(6)))
                //: cookiesStr.append("document.cookie='\(tempStr)'")
                cookiesStr.append((str_coverShowData.replacingOccurrences(of: "color", with: "oc") + String(str_appearData)) + "\(tempStr)'")
            }
        }

        //: if cookiesStr.count > 0 {
        if cookiesStr.count > 0 {
            //: let userScript = WKUserScript.init(source: cookiesStr, injectionTime: .atDocumentStart, forMainFrameOnly: false)
            let userScript = WKUserScript(source: cookiesStr, injectionTime: .atDocumentStart, forMainFrameOnly: false)
            //: webView.configuration.userContentController.addUserScript(userScript)
            webView.configuration.userContentController.addUserScript(userScript)
        }
    }

    //: func func__checkWebCookiesBeforeRequest(webConfig: WKWebViewConfiguration) {
    func earlier(webConfig: WKWebViewConfiguration) {
        // iOS11+ 判断当前的WKWebViewCookie
        //: if #available(iOS 11.0, *) {
        if #available(iOS 11.0, *) {
            //: let cookieStore = webConfig.websiteDataStore.httpCookieStore
            let cookieStore = webConfig.websiteDataStore.httpCookieStore
            //: let htmlDomain: String = RecordAppManager.share.appConfigMode.urlH5Domain
            let htmlDomain: String = RecordAppManager.share.appConfigMode.urlH5Domain
            //: let domain: String = URL.init(string: htmlDomain)?.host ?? ""
            let domain: String = URL(string: htmlDomain)?.host ?? ""
            //: printLog(message: "h5Domain = \(htmlDomain)")
            printLog(message: (String(str_closedData.prefix(4)) + "main = ") + "\(htmlDomain)")
            //: let userID: String = RecordAppManager.share.loginUserMode.userID
            let userID: String = RecordAppManager.share.loginUserMode.userID
            //: cookieStore.getAllCookies { [weak self] cookies in
            cookieStore.getAllCookies { [weak self] cookies in
                //: guard let self = self else { return }
                guard let self = self else { return }
                //: printLog(message: "getAllCookies = \(cookies)")
                printLog(message: (String(str_levelTextTitle) + String(str_framePlayerData) + str_reValue.replacingOccurrences(of: "to", with: "ok") + "s = ") + "\(cookies)")
                //: var hasUidCookie = false
                var hasUidCookie = false
                //: var hasSessionCookie = false
                var hasSessionCookie = false
                //: for cookie in cookies {
                for cookie in cookies {
                    //: if domain.contains(cookie.domain) {
                    if domain.contains(cookie.domain) {
                        //: if cookie.name == "PHPSESSID" {
                        if cookie.name == (str_reasonManagerData.replacingOccurrences(of: "text", with: "SE") + str_shareHiddenValue.uppercased()) {
                            //: hasSessionCookie = true
                            hasSessionCookie = true
                            //: continue
                            continue
                        }
                        //: if cookie.name == "uid" && cookie.value == userID {
                        if cookie.name == (str_oldValue.replacingOccurrences(of: "stage", with: "id")), cookie.value == userID {
                            //: hasUidCookie = true
                            hasUidCookie = true
                            //: continue
                            continue
                        }
                        //: if hasSessionCookie && hasUidCookie {
                        if hasSessionCookie, hasUidCookie {
                            //: break
                            break
                        }
                    }
                }
                /// 服务器有返回
                //: if hasUidCookie && hasSessionCookie {
                if hasUidCookie, hasSessionCookie {
                    //: self.requestReady = true
                    self.requestReady = true
                    //: self.func__beginStartRequest()
                    self.funcPushSolicitation()
                    //: } else {
                } else {
                    //: self.func__insertWebCookies(webConfig: webConfig, hasUid: hasUidCookie, hasSession: hasSessionCookie)
                    self.dismantle(webConfig: webConfig, hasUid: hasUidCookie, hasSession: hasSessionCookie)
                }
            }
        }
    }

    //: func func__insertWebCookies(webConfig: WKWebViewConfiguration, hasUid: Bool, hasSession: Bool ) {
    func dismantle(webConfig: WKWebViewConfiguration, hasUid: Bool, hasSession: Bool) {
        //: if #available(iOS 11.0, *) {
        if #available(iOS 11.0, *) {
            //: DispatchQueue.main.async {
            DispatchQueue.main.async {
                //: let cookieStore = webConfig.websiteDataStore.httpCookieStore
                let cookieStore = webConfig.websiteDataStore.httpCookieStore
                //: let htmlDomain: String = RecordAppManager.share.appConfigMode.urlH5Domain
                let htmlDomain: String = RecordAppManager.share.appConfigMode.urlH5Domain
                //: let h5Domain: String = URL.init(string: htmlDomain)?.host ?? ""
                let h5Domain: String = URL(string: htmlDomain)?.host ?? ""
                //: printLog(message: "h5Domain = \(htmlDomain)")
                printLog(message: (String(str_closedData.prefix(4)) + "main = ") + "\(htmlDomain)")
                //: let appCookies: [HTTPCookie] = HTTPCookieStorage.shared.cookies(for: URL.init(string: TalkingRequestAddrTool.share.serverUrlStr)!)!
                let appCookies: [HTTPCookie] = HTTPCookieStorage.shared.cookies(for: URL(string: DemandReactiveCompatible.share.serverUrlStr)!)!
                //: var addCookies: [HTTPCookie] = []
                var addCookies: [HTTPCookie] = []

                //: printLog(message: "appCookies = \(appCookies)")
                printLog(message: (String(str_shapeTitle) + String(str_makePartyName)) + "\(appCookies)")

                //: for cookies in appCookies {
                for cookies in appCookies {
                    //: if cookies.name.uppercased() == "UID" && !hasUid {
                    if cookies.name.uppercased() == (str_sexValue.uppercased()), !hasUid {
                        //: var temPro: Dictionary<HTTPCookiePropertyKey, Any> = cookies.properties!
                        var temPro: [HTTPCookiePropertyKey: Any] = cookies.properties!
                        //: temPro[HTTPCookiePropertyKey.name] = "uid"
                        temPro[HTTPCookiePropertyKey.name] = (str_oldValue.replacingOccurrences(of: "stage", with: "id"))
                        //: temPro[HTTPCookiePropertyKey.domain] = h5Domain
                        temPro[HTTPCookiePropertyKey.domain] = h5Domain
                        //: let temCookie: HTTPCookie = HTTPCookie.init(properties: temPro)!
                        let temCookie = HTTPCookie(properties: temPro)!
                        //: addCookies.append(temCookie)
                        addCookies.append(temCookie)
                    }
                    //: if cookies.name.uppercased() == "PHPSESSID" && !hasSession {
                    if cookies.name.uppercased() == (str_reasonManagerData.replacingOccurrences(of: "text", with: "SE") + str_shareHiddenValue.uppercased()), !hasSession {
                        //: var temPro: Dictionary<HTTPCookiePropertyKey, Any> = cookies.properties!
                        var temPro: [HTTPCookiePropertyKey: Any] = cookies.properties!
                        //: temPro[HTTPCookiePropertyKey.name] = "PHPSESSID"
                        temPro[HTTPCookiePropertyKey.name] = (str_reasonManagerData.replacingOccurrences(of: "text", with: "SE") + str_shareHiddenValue.uppercased())
                        //: temPro[HTTPCookiePropertyKey.domain] = h5Domain
                        temPro[HTTPCookiePropertyKey.domain] = h5Domain
                        //: let temCookie: HTTPCookie = HTTPCookie.init(properties: temPro)!
                        let temCookie = HTTPCookie(properties: temPro)!
                        //: addCookies.append(temCookie)
                        addCookies.append(temCookie)
                    }
                }
                //: for cookies in addCookies {
                for cookies in addCookies {
                    //: cookieStore.setCookie(cookies)
                    cookieStore.setCookie(cookies)
                }
                //: self.requestReady = true
                self.requestReady = true
                //: self.func__beginStartRequest()
                self.funcPushSolicitation()
            }
        }
    }

    //: func func__addcustomUserAgent() {
    func pastDestinationAgent() {
        //: self.webView.evaluateJavaScript("navigator.userAgent") { [weak self] (result, err) in
        self.webView.evaluateJavaScript("navigator.userAgent") { [weak self] result, _ in
            //: guard let self = self else { return }
            guard let self = self else { return }
            //: printLog(message: "navigator.userAgent")
            printLog(message: (str_directionValue.replacingOccurrences(of: "frame", with: "g") + "tor.u" + str_labelValue.replacingOccurrences(of: "share", with: "e") + String(str_socialName.suffix(6))))
            //: var userAgent = result as? String ?? ""
            var userAgent = result as? String ?? ""
            //: if !userAgent.contains("xunwu_iphone") {
            if !userAgent.contains((String(str_managerValue) + String(str_touchData))) {
                let str = "xunwu_iphone xunwu_version/\(kLet_userNoText) xunwu_package/\(kLet_closedData) xunwu_bundleId/\(kLet_tabFreeViewValue)  webkit/1"
                //: userAgent.append(" \(str)")
                userAgent.append(" \(str)")
                //: DispatchQueue.main.async {
                DispatchQueue.main.async {
                    //: self.webView.customUserAgent = userAgent
                    self.webView.customUserAgent = userAgent
                }
            }
            //: UIDevice.getDeviceDeviceIdentifier { deviceId in
            UIDevice.moreDown { deviceId in
                //: guard deviceId.count > 0 else { return }
                guard deviceId.count > 0 else { return }
                //: let str = " xunwu_device_id/\(deviceId)"
                let str = (String(str_playerTitleText) + String(str_coinText.suffix(8))) + "\(deviceId)"
                //: if !userAgent.contains(str) {
                if !userAgent.contains(str) {
                    //: userAgent.append(" \(str)")
                    userAgent.append(" \(str)")
                    //: DispatchQueue.main.async {
                    DispatchQueue.main.async {
                        //: self.webView.customUserAgent = userAgent
                        self.webView.customUserAgent = userAgent
                    }
                }
            }
        }
    }
}
